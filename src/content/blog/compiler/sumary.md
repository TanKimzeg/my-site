---
title: "è¯¾ç¨‹æ€»ç»“ | ç¼–è¯‘åŸç†"
description: PKUç¼–è¯‘åŸç†å®è·µè¯¾ç¨‹
pubDate: 2025 08 31
categories: 
  - tech
tags:
  - compiler
  - rust
---

ç»ˆäºç»™PKU-MiniCçš„æ—…é€”ç”»ä¸Šäº†ä¸€ä¸ªå¥å·,å®ç°äº†ä¸€ä¸ªèƒ½ç¼–è¯‘Cè¯­è¨€å­é›†çš„ç¼–è¯‘å™¨.

### å±€é™
ç›®å‰è¿˜æ²¡å¯¹ä»£ç è¿›è¡Œç¼–è¯‘æ—¶ä¼˜åŒ–,ä¸´æ—¶å˜é‡éƒ½æ”¾åœ¨æ ˆé‡Œ,æ²¡æœ‰å……åˆ†åˆ©ç”¨å¯„å­˜å™¨åˆ†é….æˆ‘ä»¬éƒ½çŸ¥é“,å¯„å­˜å™¨çš„å­˜å–é€Ÿåº¦å’ŒCPUç¼“å­˜\å†…å­˜ä¹‹é—´å·®äº†ä¸€ä¸ªæ•°é‡çº§,è¿™å°±å¯¼è‡´ä»£ç è¿è¡Œæ•ˆç‡ä½,ç›¸å½“äºç»™æ¯ä¸ªå˜é‡éƒ½åŠ ä¸Šäº†`votatile`å…³é”®å­—.

è¯´ç™½äº†,ç°åœ¨çš„ç¼–è¯‘å™¨~~æ²¡æœ‰ä»€ä¹ˆå®ç”¨æ€§(å­¦ç”Ÿé¡¹ç›®éƒ½è¿™æ ·å˜›)~~åªæ˜¯ä¸€ä¸ªç©å…·,è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°.å½“ç„¶äº†,åšç¼–è¯‘å™¨æ˜¯æ²¡æœ‰ç»ˆç‚¹çš„,ç¼–è¯‘å™¨çš„æ ‡æ†GCCå·²ç»æ˜¯åºç„¶å¤§ç‰©äº†.è€Œå¯¹äºå¤æ‚çš„è¯­è¨€,rustcä¹Ÿåœ¨ä¸æ–­æ”¹è¿›.

### æˆå°±
å®¹å™¨é‡Œé¢è‡ªå¸¦çš„130ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡,ä¸‹é¢çš„lisp.cä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨,åº”è¯¥æ²¡æœ‰ä»€ä¹ˆbugäº†å§.

SysYè¯­è¨€æ˜¯å›¾çµå®Œå¤‡çš„.è¿™æ„å‘³ç€æˆ‘å¯ä»¥ç”¨å®ƒç¼–å†™ä»»ä½•ç¨‹åº.

ç¼–è¯‘åŸç†å¯è°“æ˜¯è®¡ç®—æœºç§‘å­¦çš„å± é¾™æœ¯ä¹‹ä¸€,ç”±æ­¤å¼€å¯è®¡ç®—æœºè½¯ä»¶çš„ä¸–ç•Œ.æ¯”å¦‚SysYç¼–å†™çš„Lispè¯­è¨€è§£é‡Šå™¨.

### ç¼–è¯‘ä¸é“¾æ¥
åœ¨ç¼–è¯‘lisp.cä¹‹å‰,å…ˆæ¥ç ”ç©¶ä¸€ä¸‹æ€ä¹ˆç¼–è¯‘é“¾æ¥æˆå¯æ‰§è¡Œæ–‡ä»¶.å®¹å™¨ä¸­çš„`autotest`æµ‹è¯•è„šæœ¬æ˜¯Pythonå†™çš„.å€Ÿé‰´è¿™ä¸ªè„šæœ¬,ChatGPT5å†™å‡ºäº†Makefile,æˆ‘å°±ä¸è¯¦ç»†ä»‹ç»äº†.

åœ¨`tests`ä¸‹è¿è¡Œ
```shell
make clean
make SRC=./lisp.c MODE=koopa 2>/dev/null
./build/lisp < input.lisp
```

æˆ–è€…
```shell
make clean
make SRC=./lisp.c MODE=riscv 2>/dev/null
qemu-riscv32-static ./build/lisp < input.lisp
```

å³å¯æ‰§è¡ŒLispè„šæœ¬.å¯¹äºæµ‹è¯•å•ä¾‹æ¥è¯´,ä¼šè¾“å‡ºæ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç¬¬20ä¸ªæ•°.

---
å¿…é¡»èµèµ,æœ¬è¯¾ç¨‹è®¾è®¡è¿˜æ˜¯å¾ˆåˆç†çš„,å­¦ä¹ æ›²çº¿æ—¶å¹³æ—¶é™¡,å–å†³äºé‡æ„ä»£ç çš„å†³å¿ƒå’Œæ¯…åŠ›.æ–‡æ¡£è´¨é‡ä¹Ÿå¾ˆé«˜,ä½†æœ‰å°éƒ¨åˆ†è¿‡äºç®€ç•¥,å¿½ç•¥äº†é‡è¦ç»†èŠ‚,ç»™ä»£ç ç¼–å†™é€ æˆäº†ä¸€äº›å›°æƒ‘.MaxXingåŠ©æ•™ç¼–å†™æ–‡æ¡£å’Œä¸­é—´ä»¶èŠ±äº†å¾ˆå¤šå¿ƒè¡€,ä½¿å¾—æˆ‘ä»¬æ–°æ‰‹å…¥æ‰‹ä¸æ˜¯ç‰¹åˆ«å›°éš¾.Respect!

å›æƒ³ä¹‹å‰,é¢å¯¹â€˜ç¼–è¯‘å™¨â€™è¿™ä¸‰ä¸ªå­—è¿˜æ²¡æœ‰ä»€ä¹ˆæ¦‚å¿µ,åªè§‰å¾—å®ƒååˆ†èªæ˜.ç°åœ¨å›å¤´çœ‹,æ”¶è·ä¸ä»…æ˜¯è¿™ä¸ªâ€˜ç©å…·â€™æœ¬èº«ï¼Œè¿˜æœ‰æ•´ä¸ªè¿‡ç¨‹é”»ç‚¼æˆ‘çš„èƒ½åŠ›: 

- **æ‹†è§£é—®é¢˜çš„èƒ½åŠ›**ï¼šä¸€ä¸ªåºå¤§çš„å·¥ç¨‹è¢«æ¨ªå‘åˆ†è§£æˆè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æã€IRç”Ÿæˆã€ä»£ç ä¼˜åŒ–ã€ç›®æ ‡ä»£ç ç”Ÿæˆå¤šä¸ªæ­¥éª¤,çºµå‘åˆ†è§£æˆ9ä¸ªlevelåï¼Œæ¯ä¸€æ­¥éƒ½å˜å¾—æ¸…æ™°å¯è¡Œã€‚
    
- **æ·±åº¦è°ƒè¯•çš„è€å¿ƒ**ï¼šä¸ºäº†ä¸€ä¸ªbugï¼Œèƒ½å¯¹ç€ç”Ÿæˆçš„æ±‡ç¼–ä»£ç å’Œæ—¥å¿—ç¢ç£¨ä¸€æ™šä¸Šï¼Œè¿™ç§â€˜å¼ºè¿«ç—‡â€™ç°åœ¨æˆäº†æˆ‘è§£å†³é—®é¢˜çš„åˆ©å™¨ã€‚
    
- **å¯¹è®¡ç®—æœºå·¥ä½œçš„æ·±åˆ»ç†è§£**ï¼šç°åœ¨å†™ä»£ç æ—¶ï¼Œä»¿ä½›èƒ½â€˜çœ‹â€™åˆ°ç¼–è¯‘å™¨åœ¨èƒŒåé»˜é»˜çš„å·¥ä½œ,ä»¥åŠå®ƒçš„èªæ˜åˆ†æ.è¿™ä¸ªè§†è§’éå¸¸æœ‰æ„æ€.
    

æˆ‘æƒ³å¯¹å¤§å®¶è¯´ï¼š**è¿™æ˜¯ä¸€é—¨èƒ½è®©ä½ å®Œæˆâ€˜èœ•å˜â€™çš„è¯¾ç¨‹**ã€‚ä¸è¦ç•éš¾ï¼Œè·Ÿç€è¯¾ç¨‹è®¾è®¡ä¸€æ­¥æ­¥æ¥ï¼Œä½ ç»å¯¹ä¼šæ¯”æƒ³è±¡ä¸­æ›´å¼ºå¤§ã€‚æ¯ä¸€æ¬¡å½“ä½ çœ‹åˆ°è‡ªå·±çš„ç¼–è¯‘å™¨é€šè¿‡ä¸€ç« æ—¶,ä½ ä¼šè§‰å¾—ä¸€åˆ‡åŠªåŠ›éƒ½æ˜¯å€¼å¾—çš„.

"è¿™é‡Œä¸æ˜¯ç»ˆç‚¹ï¼Œè€Œæ˜¯ä¸€ä¸ªæ–°çš„èµ·ç‚¹ã€‚è‡´æ•¬æ¯ä¸€ä½è®¡ç®—æœºä¸–ç•Œçš„é€ ç‰©ä¸»!"

> *ç»Ÿè®¡äº†ä¸€ä¸‹è¿™ä¸ªå·¥ç¨‹çš„ä»£ç é‡,ä¸€å…±æœ‰ä¸¤åƒäº”ç™¾å¤šè¡Œçš„Rust, ä»¥åŠä¸€äº›.lalrpop.æœ€è¿‘çŸ­çŸ­ä¸€ä¸ªæœˆå†™çš„Rust,å·²ç»è¶…è¿‡æˆ‘ä»¥å‰å†™è¿‡çš„Cäº†.Rust,çœŸçš„ä¸é”™!*


**æˆ‘ä»¬æ¯”è‡ªå·±æƒ³è±¡ä¸­çš„è¿˜è¦å¼º**ğŸ˜
