---
title: "课程总结 | 编译原理"
description: PKU编译原理实践课程
pubDate: 2025 08 31
categories: 
  - tech
tags:
  - compiler
  - rust
---

终于给PKU-MiniC的旅途画上了一个句号,实现了一个能编译C语言子集的编译器.

### 局限
目前还没对代码进行编译时优化,临时变量都放在栈里,没有充分利用寄存器分配.我们都知道,寄存器的存取速度和CPU缓存\内存之间差了一个数量级,这就导致代码运行效率低,相当于给每个变量都加上了`votatile`关键字.

说白了,现在的编译器~~没有什么实用性(学生项目都这样嘛)~~只是一个玩具,还有很长的路要走.当然了,做编译器是没有终点的,编译器的标杆GCC已经是庞然大物了.而对于复杂的语言,rustc也在不断改进.

### 成就
容器里面自带的130个测试全部通过,下面的lisp.c也能正常使用,应该没有什么bug了吧.

SysY语言是图灵完备的.这意味着我可以用它编写任何程序.

编译原理可谓是计算机科学的屠龙术之一,由此开启计算机软件的世界.比如SysY编写的Lisp语言解释器.

### 编译与链接
在编译lisp.c之前,先来研究一下怎么编译链接成可执行文件.容器中的`autotest`测试脚本是Python写的.借鉴这个脚本,ChatGPT5写出了Makefile,我就不详细介绍了.

在`tests`下运行
```shell
make clean
make SRC=./lisp.c MODE=koopa 2>/dev/null
./build/lisp < input.lisp
```

或者
```shell
make clean
make SRC=./lisp.c MODE=riscv 2>/dev/null
qemu-riscv32-static ./build/lisp < input.lisp
```

即可执行Lisp脚本.对于测试单例来说,会输出斐波那契数列的第20个数.

---
必须赞赏,本课程设计还是很合理的,学习曲线时平时陡,取决于重构代码的决心和毅力.文档质量也很高,但有小部分过于简略,忽略了重要细节,给代码编写造成了一些困惑.MaxXing助教编写文档和中间件花了很多心血,使得我们新手入手不是特别困难.Respect!

回想之前,面对‘编译器’这三个字还没有什么概念,只觉得它十分聪明.现在回头看,收获不仅是这个‘玩具’本身，还有整个过程锻炼我的能力: 

- **拆解问题的能力**：一个庞大的工程被横向分解成词法分析、语法分析、语义分析、IR生成、代码优化、目标代码生成多个步骤,纵向分解成9个level后，每一步都变得清晰可行。
    
- **深度调试的耐心**：为了一个bug，能对着生成的汇编代码和日志琢磨一晚上，这种‘强迫症’现在成了我解决问题的利器。
    
- **对计算机工作的深刻理解**：现在写代码时，仿佛能‘看’到编译器在背后默默的工作,以及它的聪明分析.这个视角非常有意思.
    

我想对大家说：**这是一门能让你完成‘蜕变’的课程**。不要畏难，跟着课程设计一步步来，你绝对会比想象中更强大。每一次当你看到自己的编译器通过一章时,你会觉得一切努力都是值得的.

"这里不是终点，而是一个新的起点。致敬每一位计算机世界的造物主!"

> *统计了一下这个工程的代码量,一共有两千五百多行的Rust, 以及一些.lalrpop.最近短短一个月写的Rust,已经超过我以前写过的C了.Rust,真的不错!*


**我们比自己想象中的还要强**😎
