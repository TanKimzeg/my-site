---
title: Springé¡¹ç›®ï¼šæœŸåˆŠåœ¨çº¿ç¨¿ä»¶é‡‡ç¼–ç³»ç»Ÿ
description: ä¸€ä¸ªå¾ªåºæ¸è¿›çš„æœŸåˆŠç¨¿ä»¶é‡‡ç¼–ç³»ç»Ÿå­¦ä¹ è®°å½•ã€‚è¿™ä¸ªé¡¹ç›®å°†æ¶µç›–å®Œæ•´çš„è½¯ä»¶å¼€å‘çŸ¥è¯†ä½“ç³»ã€‚
pubDate: 2026-01-27
categories:
  - tech
tags:
  - java
  - software
image: /backend/editorial-system-backend.png
---

å‰æ®µæ—¶é—´åœ¨æŠ•ç¨¿ï¼Œæ•´ä¸ªç³»ç»Ÿçœ‹èµ·æ¥åƒæ˜¯2000å¹´ä»£çš„ç½‘é¡µé£æ ¼ï¼Œæ‰“å¼€F12ï¼Œæ¥å£è¿”å›çš„æ˜¯HTMLä»£ç ï¼Œæœç„¶æ˜¯PHPçš„å‰åç«¯ä¸åˆ†ç¦»Webåº”ç”¨ã€‚è¿™éƒ½ä»€ä¹ˆå¹´ä»£äº†ï¼Œç½‘ç«™è¿˜è¿™ä¹ˆè½åï¼ŒçœŸçš„ä¸å ªå…¥ç›®å•Šâ€¦â€¦

æ­£å¥½æœ€è¿‘åœ¨å­¦ä¹ è®¾è®¡æ¨¡å¼å’ŒJavaè¯­è¨€ï¼Œäºæ˜¯æˆ‘æƒ³ä»¥è®¾è®¡ä¸€ä¸ªç±»ä¼¼çš„æŠ•ç¨¿ç³»ç»Ÿä¸ºä¾‹æ¥å­¦ä¹ Springç­‰æŠ€æœ¯æ ˆã€‚æ‰“å¼€Githubï¼Œæœç´¢ä¸€äº›å…³é”®è¯ï¼Œå‘ç°ç›¸å…³é¡¹ç›®è¾ƒå°‘ï¼Œè€Œä¸”ä»¥æ¯•è®¾ä¸ºä¸»ï¼Œ[ä¾‹å¦‚è¿™ä¸ª](https://github.com/yafeng-Soong/paperbackend/)ï¼Œæœ‰çš„æ—¶é—´ä¹…è¿œï¼Œå·¥å…·é“¾è½åï¼Œè´¨é‡æ€»ä½“ä¸é«˜ï¼Œæ‰€ä»¥æˆ‘å†³å®šæ¨¡ä»¿ç¨¿ä»¶å¤„ç†ä¸€ç³»åˆ—æµç¨‹ï¼Œäº²è‡ªå¼€å‘ä¸€ä¸ªSpring Webåº”ç”¨ï¼ŒåŒæ—¶ä½“éªŒè½¯ä»¶çš„è®¾è®¡å‘¨æœŸï¼ŒæŒæ¡è®¾è®¡æ€æƒ³ã€‚

Javaè‡ªä»1995å¹´è¯ç”Ÿä»¥æ¥ï¼Œå‡­å€Ÿå…¶â€œä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œâ€çš„ç‰¹ç‚¹ï¼Œé£é¡ä¸–ç•Œã€‚æˆ‘è®°å¾—æˆ‘å°æ—¶å€™ï¼Œå°±æ˜¯æŒ‰é”®æ‰‹æœºå’Œåæ¥ä¸‰æ˜Ÿçš„æ—©æœŸè§¦å±æ‰‹æœºé‚£ä¸ªå¹´ä»£ï¼Œå¾ˆå¤šè½¯ä»¶éƒ½æ˜¯Javaç¼–å†™çš„ã€‚åœ¨æ‰‹æœºçš„å­˜å‚¨ç›®å½•é‡Œé¢ç»å¸¸èƒ½çœ‹åˆ°.jaråŒ…ï¼Œè¿˜æœ‰Oracel JDKé‚£ä¸ªå’–å•¡å›¾æ ‡ï¼Œæˆ‘éƒ½æœ‰å°è±¡ï¼Œæˆ‘è¿ç”µè„‘éƒ½ä¸ä¼šç”¨å‘¢ï¼Œå°±çŸ¥é“Javaäº†ã€‚ä¸Šå°å­¦çš„æ—¶å€™å¼€å§‹ç©Minecraftï¼Œæˆ‘ä¹ŸçŸ¥é“â€œJavaç‰ˆâ€å’Œåæ¥æ‰æœ‰çš„â€œåŸºå²©ç‰ˆâ€ã€‚è¿™å¯¼è‡´æˆ‘ä¸€ç›´å¯¹Javaçš„å°è±¡æ˜¯ç¼–å†™æ¸¸æˆå’Œè½¯ä»¶çš„ã€‚å®é™…ä¸Šä¹Ÿæ²¡é”™ï¼Œä½†æ˜¯åœ¨å›½å†…çš„æ°›å›´ä¸‹ï¼ŒWebåç«¯å æ®å½“å‰äº’è”ç½‘ä¼ä¸šçš„å¤§éƒ¨åˆ†ä¸šåŠ¡ï¼Œè¿™å£æ°”ç°åœ¨å°±é Springæ’‘ç€äº†ï¼Œè¿˜æ˜¯é˜¿é‡Œç³»å¸¦èµ·æ¥çš„ã€‚æˆ‘åœ¨ä¸­å‚å®ä¹ çš„æ—¶å€™ï¼Œé‚£è¾¹ä¹Ÿç”¨çš„æ˜¯SpringBootï¼Œæ‰€ä»¥æˆ‘å¯¹å¸¸è§„çš„CRUDæ“ä½œã€My-batisç¼–å†™SQLå·²ç»ç†Ÿæ‚‰ï¼Œä½†å§‹ç»ˆè§‰å¾—æ²¡æœ‰å­¦åˆ°ä¸œè¥¿ï¼Œéƒ½æ˜¯ä¾ç…§é¡¹ç›®çš„æ ·æ¿ä»£ç æ¥çš„ã€‚å€ŸåŠ©è¿™ä¸ªæœºä¼šï¼Œæˆ‘æ¥é‡æ–°å­¦ä¹ Springçš„ä¸€äº›æŠ€æœ¯æ ˆï¼Œä½¿ç”¨æœ€æ–°çš„å¼€å‘ç¯å¢ƒï¼Œé‡‡ç”¨ç¬¦åˆè‡ªå·±å“å‘³çš„æŠ€æœ¯å®è·µã€‚æˆ‘é€šè¿‡ä¸DeepSeekå’ŒGithub Copilotå¯¹è¯ï¼Œå¾—ä»¥å¿«é€Ÿæ­å»ºé¡¹ç›®ã€‚

## æ­å»ºå¹¶è¿è¡Œé¡¹ç›®

**é˜¶æ®µ1ï¼š**åˆ›å»ºSpring Booté¡¹ç›®å¹¶ç†è§£åŸºç¡€ç»“æ„

é¦–å…ˆåˆ°[Spring Initializr](https://start.spring.io/)é€‰æ‹©ä¾èµ–å¹¶ä¸‹è½½
é€‰æ‹©ï¼š

- Project: Maven

- Language: Java

- Spring Boot: 4.0.1

- Group: top.tankimzeg

- Artifact: journal-editorial-system

- ä¾èµ–ï¼šSpring Web, Spring Data JPA, MySQL Driver

ç”¨IDEAæ‰“å¼€ã€‚æˆ‘è‡ªå·±é…ç½®äº†Mavenå’Œé•œåƒæºï¼Œæ‰€ä»¥ä¸éœ€è¦MavenåŒ…è£…å™¨ã€‚ç­‰ç€IDEAæ…¢æ…¢è½¬ï¼Œä¸‹è½½å¥½ä¾èµ–ã€‚

æˆ‘çš„å¼€å‘ç¯å¢ƒååˆ†æ¿€è¿›ï¼ŒJDK 25 + SpringBoot 4.0.1 éƒ½æ˜¯ç›®å‰æœ€æ–°ç¨³å®šç‰ˆã€‚

ç‚¹å‡»è¿è¡Œæ¨¡æ¿çš„ `EditorialSystemApplication`ï¼Œå‘ç°æŠ¥é”™ "Data Source" ç›¸å…³ã€‚åŸæ¥ï¼Œ
`@SpringBootApplication` [æ³¨è§£](https://docs.springframework.org.cn/spring-boot/tutorial/first-application/index.html#getting-started.first-application.code.spring-boot-application)åŒ…å«äº†è‡ªåŠ¨é…ç½®ï¼Œéœ€è¦æˆ‘å» `resource/application.yml` é…ç½®æ•°æ®åº“è¿æ¥ï¼Œå³ä½¿ç°åœ¨è¿˜æ²¡æœ‰ç”¨åˆ°æ•°æ®åº“æŒä¹…åŒ–æ“ä½œã€‚å°±åƒè¿™æ ·ï¼š

```yaml
spring:
 datasource:  
   url: jdbc:mysql://localhost:3306/spring_application?useUnicode=true&characterEncoding=UTF-8&useSSL=false  
   driver-class-name: com.mysql.cj.jdbc.Driver  
   username: spring  
   password: spring  
   type: com.zaxxer.hikari.HikariDataSource  
   hikari:  
     maximum-pool-size: 8  
     auto-commit: true
```

æ•°æ®è®¿é—®å±‚ç”¨çš„ä¸æ˜¯MyBatisï¼Œè€Œæ˜¯Spring Data Jpaã€‚Spring Data JPA æ˜¯ Spring æ¡†æ¶ä¸­ç”¨äºç®€åŒ–æ•°æ®è®¿é—®å±‚å¼€å‘çš„æ ¸å¿ƒæ¨¡å—ã€‚å®ƒåŸºäº JPA è§„èŒƒï¼Œåº•å±‚ä½¿ç”¨Â Hibernateå®ç°ï¼Œé€šè¿‡æ¥å£ç»§æ‰¿å’Œæ–¹æ³•å‘½åè§„åˆ™ï¼Œè‡ªåŠ¨å®ç°å¢åˆ æ”¹æŸ¥ç­‰å¸¸è§æ“ä½œã€‚

```yaml
spring:
 jpa:  
   hibernate:  
     ddl-auto: update  
   database-platform: org.hibernate.dialect.MySQLDialect  
   show-sql: true  
   # å¦‚æœè¦ç”¨ data.sql åˆå§‹åŒ–æ•°æ®ï¼Œéœ€è¦åŠ ä¸Šè¿™ä¸ªé…ç½®  
   defer-datasource-initialization: true
```

ç°åœ¨æˆåŠŸå¯åŠ¨äº†ï¼å†…å­˜å‡é«˜ï¼Œé£æ‰‡ä¹Ÿå“äº†èµ·æ¥ï¼

åˆ›å»ºç¬¬ä¸€ä¸ªController:

```java
package top.tankimzeg.manuscript_system.controller;  
  
import org.springframework.http.ResponseEntity;  
import org.springframework.web.bind.annotation.GetMapping;  
import org.springframework.web.bind.annotation.RestController;  
  
@RestController  
public class HelloController {  
  
    @GetMapping("/hello")  
    public ResponseEntity<String> hello(){  
        return ResponseEntity.ok("æœŸåˆŠåœ¨çº¿ç¨¿ä»¶ç®¡ç†ç³»ç»Ÿï¼");  
    }  
}
```

æµè§ˆå™¨è®¿é—® <http://localhost:8080/hello> ï¼Œå³å¯çœ‹åˆ°è¿™è¡Œå­—ã€‚

**é˜¶æ®µ2ï¼š**æ•°æ®åº“è®¾è®¡ä¸åŸºç¡€CRUD

æˆ‘ä»¬æ¥è®¾è®¡ç¬¬ä¸€ä¸ªå®ä½“ç±»ï¼šUserã€‚
ç”¨æˆ·ä¸»è¦æœ‰ä¸‰ä¸ªè§’è‰²ï¼šä½œè€…ã€å®¡ç¨¿äººã€ç¼–è¾‘ã€‚ç¨¿ä»¶ä¼šåœ¨è¿™ä¸‰ä¸ªäººä¹‹é—´æµè½¬ï¼Œç¨¿ä»¶å¤„ç†æµç¨‹ä¹Ÿéœ€è¦ä»–ä»¬æ¥å¤„ç†ã€‚ä½œè€…å¯ä»¥è½¬åŒ–ä¸ºå®¡ç¨¿äººï¼Œç”¨çš„ä¹Ÿæ˜¯åŒä¸€ä¸ªç™»å½•æ¥å£ï¼Œåªæ˜¯å®¡ç¨¿äººèƒ½çœ‹åˆ°ç¼–è¾‘å®‰æ’çš„å®¡ç¨¿éœ€æ±‚ã€‚

```java
package top.tankimzeg.editorial_system.entity;  
  
import jakarta.persistence.*;  
import lombok.Data;  
import org.hibernate.annotations.CreationTimestamp;  
import org.hibernate.annotations.UpdateTimestamp;  
  
import java.time.LocalDateTime;  
  
@Entity  
@Table(name = "users")  
@Data  
public class User {  
  
    @Id  
    @GeneratedValue(strategy = GenerationType.IDENTITY)  
    private Long id;  
  
    @Column(unique = true, nullable = false)  
    private String username;  
  
    @Column(nullable = false)  
    private String password;  
  
    @Column(unique = true, nullable = false)  
    private String email;  
  
    @Column(name = "real_name")  
    private String realName;  
  
    public enum Role {  
        AUTHOR,  
        REVIEWER,  
        EDITOR  
    }  
  
    @Enumerated(EnumType.STRING)  
    @Column(nullable = false)  
    private Role role = Role.AUTHOR;  
  
    @CreationTimestamp  
    @Column(name = "created_at", updatable = false)  
    private LocalDateTime createdAt;  
  
    @UpdateTimestamp  
    @Column(name = "updated_at")  
    private LocalDateTime updatedAt;  
  
}
```

åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå®ä½“ç±»ç»è¿‡äº†å¤šæ¬¡å˜æ›´ï¼Œåå¤æ¨å®šï¼Œæœ€åæ‰è¾¾åˆ°åŠŸèƒ½å’Œä»£ç ç®€æ´æ€§çš„ç»Ÿä¸€ã€‚

æ€»ä½“ä¸Šçš„éœ€æ±‚å°±æ˜¯æˆ‘æ‰€ç»å†çš„ç¨¿ä»¶ç”Ÿå‘½å‘¨æœŸã€‚è¿™é‡Œè¿˜æœ‰ä¸€ç¯‡å–æ¯•è®¾çš„ï¼Œå¦‚æœä½ æ²¡æœ‰ä½“éªŒè¿‡æŠ•ç¨¿è¿‡ç¨‹ï¼Œå¯ä»¥å‚è€ƒ <https://blog.csdn.net/sheji717/article/details/144497868>

æ¥ä¸‹æ¥åˆ›å»ºRepositoryæ¥å£ï¼Œè¿™æ˜¯ç¨‹åºå¯¹æ•°æ®åº“è¿›è¡Œè®¿é—®å’Œæ“ä½œçš„ä¸€å±‚æŠ½è±¡ã€‚

```java
package top.tankimzeg.editorial_system.repository;  
  
import org.springframework.data.jpa.repository.JpaRepository;  
import org.springframework.stereotype.Repository;  
import top.tankimzeg.editorial_system.entity.User;  
  
import java.util.Optional;  
  
@Repository  
public interface UserRepo extends JpaRepository<User, Long> {  
  
    Optional<User> findUserByUsername(String username);  
  
    boolean existsUserByUsername(String username);  
  
    boolean existsUserByEmail(String email);  
}
```

è·ŸMy-Batisä¸åŒï¼Œæˆ‘ä»¬ä¸éœ€è¦ç¼–å†™å®ç°æˆ–è€…SQL~~ï¼ˆä»¥å‰è¿‡çš„æ˜¯ä»€ä¹ˆæ—¥å­ï¼‰~~ã€‚Jpaå¾ˆç¥å¥‡ï¼Œé€šè¿‡å‡½æ•°åå°±èƒ½ç”ŸæˆæŸ¥è¯¢ã€‚å¯¹äºå¤æ‚çš„æŸ¥è¯¢ï¼Œå¯ä»¥é€šè¿‡æ³¨è§£æ‰‹åŠ¨ç¼–å†™ï¼ˆæœ¬é¡¹ç›®ç”¨ä¸ä¸Šï¼Œæˆ‘è§‰å¾—å¦‚æœéœ€è¦é‚£ç§æŸ¥è¯¢ï¼Œå¾—æƒ³æƒ³æ˜¯ä¸æ˜¯è¡¨æ²¡è®¾è®¡å¥½ï¼‰ã€‚å¯¹äºè”è¡¨æŸ¥è¯¢ï¼Œåœ¨å®ä½“ç±»ä¸­å°±è¦å…ˆå£°æ˜å¥½ï¼Œå°±åƒè¿™æ ·ï¼š

```java
package top.tankimzeg.editorial_system.entity;  
  
import jakarta.persistence.*;  
import lombok.Data;  
  
/**  
 * @author Kim  
 * @date 2026/1/18 23:21  
 * @description ä½œè€…ã€ä¸“å®¶ä¸ªäººè¯¦ç»†ä¿¡æ¯å®ä½“ç±»  
 */
@Entity  
@Table(name = "author_profiles")  
@Data  
public class AuthorProfile {  
  
    @Id  
    @Column(name = "author_id")  
    private Long id; // ä¸ users.id å…±äº«ä¸»é”®ï¼ˆåŒæ—¶ä½œä¸ºå¤–é”®ï¼‰  
  
    @OneToOne(fetch = FetchType.LAZY, optional = false)  
    @MapsId  
    @JoinColumn(name = "author_id", referencedColumnName = "id")  
    private User author;          // å…³è”çš„ä½œè€…ç”¨æˆ·  
  
    @Embedded  
    private Profile profile;      // é€šç”¨ä¸ªäººèµ„æ–™  
}
```

```java
package top.tankimzeg.editorial_system.entity;  
  
import jakarta.persistence.*;  
import lombok.Data;  
import org.hibernate.annotations.CreationTimestamp;  
import org.hibernate.annotations.UpdateTimestamp;  
  
import java.time.LocalDateTime;  
import java.util.HashSet;  
import java.util.Set;  
  
/**  
 * @author Kim  
 * @date 2026/1/19 10:32  
 * @description ç¨¿ä»¶å®ä½“ç±»  
 */@Entity  
@Table(name = "manuscripts")  
@Data  
public class Manuscript {  
    @Id  
    @GeneratedValue(strategy = GenerationType.IDENTITY)  
    private Long id;  
  
    private String title;  
  
    private String abstractText;  
  
    private String keywords;  
  
    private String fields;  // ç ”ç©¶é¢†åŸŸ  
  
    @ManyToOne(fetch = FetchType.LAZY)  
    @JoinColumn(name = "author_id", nullable = false)  
    private User author;  // æŠ•ç¨¿ä½œè€…  
  
    @Enumerated(EnumType.STRING)  
    private ManuscriptStatus status;  // ç¨¿ä»¶çŠ¶æ€  
  
    public enum ManuscriptStatus {  
        SUBMITTED,              // å·²æäº¤  
        UNDER_REVIEW,           // å®¡æ ¸ä¸­  
        REVIEW_COMPLETED,       // å®¡æ ¸å®Œæˆ  
        UNDER_REVISION,         // ä¿®è®¢ä¸­  
        REVISION_COMPLETED,     // ä¿®è®¢å®Œæˆ  
        ACCEPTED,               // å·²æ¥å—  
        REJECTED,               // å·²æ‹’ç»  
        PUBLISHED,              // å·²å‘è¡¨  
        WITHDRAWN               // å·²æ’¤å›  
    }  
  
    @CreationTimestamp  
    @Column(name = "submitted_at", updatable = false)  
    private LocalDateTime submittedAt;      // æäº¤æ—¶é—´  
  
    @UpdateTimestamp  
    @Column(name = "updated_at")  
    private LocalDateTime updatedAt;  
  
    @OneToMany(mappedBy = "manuscript", cascade = CascadeType.ALL, orphanRemoval = true)  
    private Set<ManuscriptProcess> manuscriptProcesses = new HashSet<>();  
  
    @OneToMany(mappedBy = "manuscript", cascade = CascadeType.ALL, orphanRemoval = true)  
    private Set<ManuscriptAttachment> attachments = new HashSet<>();  
}
```

ä»£ç ä¸æ˜¯ä¸€å¼€å§‹å°±èƒ½å†™æˆè¿™æ ·çš„ï¼Œæ˜¯éšç€ä¸šåŠ¡æ‹“å±•å’Œdebugè¯•é”™è€Œé€æ­¥å®Œå–„çš„ã€‚æˆ‘ä¸€å¼€å§‹`Profile`ä¸ºäº†èƒ½ç»§æ‰¿ç”¨äº†[@Inheritance](https://www.cnblogs.com/caofanqi/p/12095841.html)æ³¨è§£ï¼Œç»“æœæ€»æ˜¯æŠ¥é”™ï¼Œåæ¥æ‰æ”¹ä¸º@Embedableã€‚

### å‚è€ƒèµ„æ–™

#### SpringBoot API

<https://docs.spring.io/spring-boot/api/java/index.html>

#### Jpa Respository

<https://zhuanlan.zhihu.com/p/31265092632>

<https://blog.csdn.net/yanfeng918/article/details/38358747>

<https://www.hxstrive.com/subject/open_jpa.htm?id=542>

## ä»£ç é€»è¾‘ç¼–å†™

æ¥ä¸‹æ¥ï¼Œæˆ‘åˆ›å»ºäº† Manuscript/Review/AuthorProfile/ManuscriptProcessç­‰å®ä½“ï¼Œç¼–å†™ä»–ä»¬çš„Repositoryï¼Œç„¶åæ˜¯Serviceã€‚å„ç§ä¸»è¦ä¸šåŠ¡é€»è¾‘éƒ½åœ¨Serviceä¸­ã€‚

## æ¥å£æµ‹è¯•

æ¥å£æµ‹è¯•æˆ‘ç›®å‰ç”¨çš„æ˜¯Knife4jï¼Œä½†æ˜¯æˆ‘çš„Knife4jæ— æ³•æ”¯æŒ `List<MutipartFile>` çš„ä¸Šä¼ ã€‚åç»­æµ‹è¯•å¯ä»¥æ”¹ç”¨postmanç­‰æ›´é«˜çº§çš„å·¥å…·ã€‚

### Knife4j

Knife4jï¼Œè¿™æ˜¯ä¸€ä¸ªSwaggerçš„å¢å¼ºå·¥å…·ï¼Œç”¨äºç”ŸæˆAPIæ–‡æ¡£å¹¶æä¾›ä¸€ä¸ªå¯äº¤äº’çš„ç•Œé¢ï¼Œæ–¹ä¾¿å¼€å‘æµ‹è¯•ã€‚

1. åœ¨pom.xmlä¸­æ·»åŠ ä¾èµ–

```xml
<dependency>
    <groupId>com.github.xiaoymin</groupId>
    <artifactId>knife4j-openapi3-jakarta-spring-boot-starter</artifactId>
    <version>4.5.0</version>
</dependency>
```

1. åœ¨`application.yml`ä¸­æ·»åŠ Knife4jçš„é…ç½®ï¼š

```yaml
# springdoc-openapié¡¹ç›®é…ç½®  
springdoc:  
  swagger-ui:  
    path: /swagger-ui.html  
    tags-sorter: alpha  
    operations-sorter: alpha  
  api-docs:  
    path: /v3/api-docs  
  packages-to-scan: top.tankimzeg.editorial_system.controller  
  default-flat-param-object: true  
# knife4jçš„å¢å¼ºé…ç½®  
knife4j:  
  enable: true  
  setting:  
    language: zh_cn  
    enable-footer-custom: true  
    enable-version: true  
    footer-custom-content: "Apache License 2.0  |  Copyright Â© 2026 æœŸåˆŠåœ¨çº¿é‡‡ç¼–ç³»ç»Ÿ"
```

1. åˆ›å»ºOpenAPIé…ç½®ç±»

åˆ›å»ºä¸€ä¸ªé…ç½®ç±»æ¥å®šä¹‰OpenAPIçš„åŸºæœ¬ä¿¡æ¯ï¼Œä¾‹å¦‚æ ‡é¢˜ã€æè¿°ã€ç‰ˆæœ¬ç­‰ã€‚

```java
package top.tankimzeg.editorial_system.config;  
  
import io.swagger.v3.oas.models.OpenAPI;  
import io.swagger.v3.oas.models.info.Contact;  
import io.swagger.v3.oas.models.info.Info;  
import io.swagger.v3.oas.models.info.License;  
import io.swagger.v3.oas.models.security.SecurityRequirement;  
import io.swagger.v3.oas.models.security.SecurityScheme;  
import org.springdoc.core.models.GroupedOpenApi;  
import org.springframework.context.annotation.Bean;  
import org.springframework.context.annotation.Configuration;  
import org.springframework.http.HttpHeaders;  
  
/**  
 * @author Kim  
 * @date 2026/1/19 10:07  
 * @description Knife4jé…ç½®ç±»  
 */@Configuration  
public class Knife4jConfig {  
  
    @Bean  
    public OpenAPI customOpenAPI() {  
        return new OpenAPI()  
                .info(new Info()  
                        .title("æœŸåˆŠé‡‡ç¼–ç³»ç»Ÿ API æ–‡æ¡£")  
                        .description("æœŸåˆŠåœ¨çº¿é‡‡ç¼–ç³»ç»Ÿåç«¯APIæ¥å£æ–‡æ¡£")  
                        .version("1.0.0")  
                        .contact(new Contact()  
                                .name("Tan Kimzeg")  
                                .email("tankimzeg@qq.com")  
                                .url("https://github.com/TanKimzeg/JournalEditorialSystem"))  
                        .license(new License()  
                                .name("Apache-2.0")  
                                .url("https://www.apache.org/licenses/LICENSE-2.0.html")))  
                .addSecurityItem(new SecurityRequirement().addList(HttpHeaders.AUTHORIZATION))  
                .components(new io.swagger.v3.oas.models.Components()  
                        .addSecuritySchemes(HttpHeaders.AUTHORIZATION,  
                                new SecurityScheme()  
                                        .type(SecurityScheme.Type.HTTP)  
                                        .scheme("bearer")  
                                        .bearerFormat("JWT")  
                                        .in(SecurityScheme.In.HEADER)  
                                        .name(HttpHeaders.AUTHORIZATION)));  
    }  
  
  
    @Bean  
    public GroupedOpenApi api() {  
        return GroupedOpenApi.builder()  
                .group("public-api")  
                .pathsToMatch("/api/**")  
                .build();  
    }  
  
}
```

ç„¶åï¼Œå°±å¯ä»¥åœ¨Controlleré‡Œé¢åŠ ä¸Šä¸€äº›æ³¨è§£ï¼š`@Tag` / `@Operation` / `@Schema` ç­‰ã€‚

## JWT ç™»å½•è®¤è¯æˆæƒ

åšå¥½äº†ä»¥ä¸Šä¸»è¦ä¸šåŠ¡é€»è¾‘çš„ç¼–å†™ä¹‹åï¼ŒControllerå±‚å´æ— æ³•ç»§ç»­ã€‚æˆ‘ä»¬å®ç°controllerä¹‹å‰éœ€è¦å…ˆå®ç°ç”¨æˆ·ç™»å½•è®¤è¯æˆæƒï¼Œè¿™æ ·åœ¨controlleré‡Œé¢æ‰èƒ½çŸ¥é“è®¿é—®æ¥å£çš„ç”¨æˆ·èº«ä»½ï¼Œä»è€Œå¡«å†™ä¸€äº›Serviceçš„authorIdå‚æ•°ã€‚

DeepSeekå‘Šè¯‰æˆ‘é‡‡ç”¨JWTæœºåˆ¶å®Œæˆç™»å½•è®¤è¯ã€‚ä»€ä¹ˆæ˜¯JWTï¼Ÿæˆ‘å…ˆå­¦ä¹ äº†ä¸€ä¸‹JWTã€‚å…³äºç™»å½•è®¤è¯çš„æœºåˆ¶æœ‰å¾ˆå¤šç§ï¼ŒJWTå¯ä»¥è¯´æ˜¯å…¶ä¸­æœ€ç®€å•çš„äº†ã€‚

**å®ç°Spring Securityç”¨æˆ·è®¤è¯æˆæƒ**ï¼š

1. æ·»åŠ Spring Securityä¾èµ–

 ```xml
 <!-- Spring Security -->  
 <dependency>  
     <groupId>org.springframework.boot</groupId>  
     <artifactId>spring-boot-starter-security</artifactId>  
 </dependency>  
   
 <!-- JWTæ”¯æŒ -->  
 <dependency>  
     <groupId>io.jsonwebtoken</groupId>  
     <artifactId>jjwt-api</artifactId>  
     <version>0.11.5</version>  
 </dependency>  
 <dependency>  
     <groupId>io.jsonwebtoken</groupId>  
     <artifactId>jjwt-impl</artifactId>  
     <version>0.11.5</version>  
     <scope>runtime</scope>  
 </dependency>  
 <dependency>  
     <groupId>io.jsonwebtoken</groupId>  
     <artifactId>jjwt-jackson</artifactId>  
     <version>0.11.5</version>  
     <scope>runtime</scope>  
 </dependency>  
   
 <!-- å¯†ç åŠ å¯† -->  
 <dependency>  
     <groupId>org.springframework.security</groupId>  
     <artifactId>spring-security-crypto</artifactId>  
 </dependency>
 ```

2. åˆ›å»ºJWTå·¥å…·ç±»

 ```java
 package top.tankimzeg.editorial_system.utils;  
   
 import io.jsonwebtoken.Claims;  
 import io.jsonwebtoken.Jwts;  
 import io.jsonwebtoken.SignatureAlgorithm;  
 import io.jsonwebtoken.security.Keys;  
 import org.springframework.beans.factory.annotation.Value;  
 import org.springframework.security.core.userdetails.UserDetails;  
 import org.springframework.stereotype.Component;  
   
 import java.security.Key;  
 import java.util.Date;  
 import java.util.HashMap;  
 import java.util.Map;  
 import java.util.function.Function;  
   
 /**  
  * @author Kim  
  * @date 2026/1/20 17:52  
  * @description JWT å·¥å…·ç±»  
  */@Component  
 public class JwtUtil {  
   
     @Value("${jwt.secret}")  
     private String secret;  
   
     @Value("${jwt.expiration}")  
     private Long expiration;  
   
     // ä»tokenä¸­æå–ç”¨æˆ·å  
     public String extractUsername(String token) {  
         return extractClaim(token, Claims::getSubject);  
     }  
   
     // ä»tokenä¸­æå–è¿‡æœŸæ—¶é—´  
     public Date extractExpiration(String token) {  
         return extractClaim(token, Claims::getExpiration);  
     }  
   
     // ä»tokenä¸­æå–æŒ‡å®šä¿¡æ¯  
     public <T> T extractClaim(String token, Function<Claims, T> claimsResolver) {  
         final Claims claims = extractAllClaims(token);  
         return claimsResolver.apply(claims);  
     }  
   
     // ä»tokenä¸­æå–æ‰€æœ‰ä¿¡æ¯  
     private Claims extractAllClaims(String token) {  
         return Jwts.parserBuilder()  
                 .setSigningKey(getSigningKey())  
                 .build()  
                 .parseClaimsJws(token)  
                 .getBody();  
     }  
   
     // æ£€æŸ¥tokenæ˜¯å¦è¿‡æœŸ  
     public Boolean isTokenExpired(String token) {  
         return extractExpiration(token).before(new Date());  
     }  
   
     // ç”Ÿæˆtoken  
     public String generateToken(UserDetails userDetails) {  
         Map<String, Object> claims = new HashMap<>();  
         return createToken(claims, userDetails.getUsername());  
     }  
   
     // åˆ›å»ºtoken  
     private String createToken(Map<String, Object> claims, String subject) {  
         return Jwts.builder()  
                 .setClaims(claims)  
                 .setSubject(subject)  
                 .setIssuedAt(new Date(System.currentTimeMillis()))  
                 .setExpiration(new Date(System.currentTimeMillis() + expiration))  
                 .signWith(getSigningKey(), SignatureAlgorithm.HS256)  
                 .compact();  
     }  
   
     // éªŒè¯token  
     public Boolean validateToken(String token, UserDetails userDetails) {  
         final String username = extractUsername(token);  
         return (username.equals(userDetails.getUsername()) && !isTokenExpired(token));  
     }  
   
     // è·å–ç­¾åå¯†é’¥  
     private Key getSigningKey() {  
         byte[] keyBytes = secret.getBytes();  
         return Keys.hmacShaKeyFor(keyBytes);  
     }  
 }
 ```

3. åˆ›å»ºUserDetailså®ç°ç±»

 ```java
 package top.tankimzeg.editorial_system.entity;  
   
 import com.fasterxml.jackson.annotation.JsonIgnore;  
 import lombok.Getter;  
 import org.springframework.security.core.GrantedAuthority;  
 import org.springframework.security.core.authority.SimpleGrantedAuthority;  
 import org.springframework.security.core.userdetails.UserDetails;  
   
 import java.util.ArrayList;  
 import java.util.Collection;  
 import java.util.List;  
   
 /**  
  * @author Kim  
  * @date 2026/1/20 17:55  
  * @description Journal User Details å®ç° UserDetails æ¥å£  
  */@Getter  
 public class JournalUserDetails implements UserDetails {  
   
     private Long id;  
   
     private String username;  
   
     @JsonIgnore  
     private String password;  
   
     private String email;  
   
     private String realName;  
   
     private User.Role role;  
   
     private Collection<? extends GrantedAuthority> authorities;  
   
     public JournalUserDetails(  
             Long id,  
             String username,  
             String password,  
             String email,  
             String realName,  
             User.Role role,  
             Collection<? extends GrantedAuthority> authorities  
     ) {  
         this.id = id;  
         this.username = username;  
         this.password = password;  
         this.email = email;  
         this.realName = realName;  
         this.role = role;  
         this.authorities = authorities;  
     }  
   
     public static JournalUserDetails build(User user) {  
         List<GrantedAuthority> authorities = new ArrayList<>();  
         authorities.add(new SimpleGrantedAuthority("ROLE_" + user.getRole().name()));  
         if (user.getRole().equals(User.Role.EDITOR))  
             authorities.add(new SimpleGrantedAuthority("ROLE_" + User.Role.AUTHOR));  
   
         return new JournalUserDetails(  
                 user.getId(),  
                 user.getUsername(),  
                 user.getPassword(),  
                 user.getEmail(),  
                 user.getRealName(),  
                 user.getRole(),  
                 authorities  
         );  
     }  
   
 }
 ```

4. åˆ›å»ºUserDetailsServiceå®ç°

 ```java
 package top.tankimzeg.editorial_system.service;  
   
 import org.springframework.beans.factory.annotation.Autowired;  
 import org.springframework.security.core.userdetails.UserDetails;  
 import org.springframework.security.core.userdetails.UserDetailsService;  
 import org.springframework.security.core.userdetails.UsernameNotFoundException;  
 import org.springframework.stereotype.Service;  
 import top.tankimzeg.editorial_system.entity.JournalUserDetails;  
 import top.tankimzeg.editorial_system.entity.User;  
 import top.tankimzeg.editorial_system.repository.UserRepo;  
   
 /**  
  * @author Kim  
  * @date 2026/1/20 18:00  
  * @description æœŸåˆŠç”¨æˆ·è¯¦æƒ…æœåŠ¡  
  */@Service  
 public class JournalUserDetailsService implements UserDetailsService {  
   
     @Autowired  
     private UserRepo userRepo;  
   
     @Override  
     public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {  
         User user = userRepo.findUserByUsername(username)  
                 .orElseThrow(() -> new UsernameNotFoundException("ç”¨æˆ·æœªæ‰¾åˆ°: " + username));  
   
         return JournalUserDetails.build(user);  
     }  
   
       
 }
 ```

5. åˆ›å»ºè®¤è¯è¯·æ±‚ã€å“åº”DTO

 ```java
 package top.tankimzeg.editorial_system.dto.request;  
   
 import lombok.Data;  
   
 /**  
  * @author Kim  
  * @date 2026/1/20 21:03  
  * @description ç™»å½•è¯·æ±‚ DTO  
  */@Data  
 public class LoginRequest {  
   
     private String username;  
   
     private String password;  
 }
 ```

 ```java
 package top.tankimzeg.editorial_system.dto.request;  
   
 import lombok.Data;  
   
 /**  
  * @author Kim  
  * @date 2026/1/20 21:04  
  * @description æ³¨å†Œè¯·æ±‚ DTO  
  */@Data  
 public class RegisterRequest {  
   
     private String username;  
   
     private String password;  
   
     private String email;  
   
     private String realName;  
   
     private String phoneNumber;  
   
     private String role = "AUTHOR";  
 }
 ```

 ```java
 package top.tankimzeg.editorial_system.dto.response;  
   
 import lombok.Data;  
   
 /**  
  * @author Kim  
  * @date 2026/1/20 21:06  
  * @description JWT å“åº” DTO  
  */@Data  
 public class JwtResponse {  
   
     private String token;  
   
     private String type = "Bearer";  
   
     private Long id;  
   
     private String username;  
   
     private String realName;  
   
     private String email;  
   
     public JwtResponse(  
             String accessToken,  
             Long id,  
             String username,  
             String realName,  
             String email  
     ) {  
         this.token = accessToken;  
         this.id = id;  
         this.username = username;  
         this.realName = realName;  
         this.email = email;  
     }  
   
 }
 ```

6. åˆ›å»ºJWTè®¤è¯è¿‡æ»¤å™¨

 ```java
 package top.tankimzeg.editorial_system.config;  
   
 import jakarta.servlet.FilterChain;  
 import jakarta.servlet.ServletException;  
 import jakarta.servlet.http.HttpServletRequest;  
 import jakarta.servlet.http.HttpServletResponse;  
 import org.springframework.beans.factory.annotation.Autowired;  
 import org.springframework.http.HttpHeaders;  
 import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;  
 import org.springframework.security.core.context.SecurityContextHolder;  
 import org.springframework.security.core.userdetails.UserDetails;  
 import org.springframework.stereotype.Component;  
 import org.springframework.util.StringUtils;  
 import org.springframework.web.filter.OncePerRequestFilter;  
 import top.tankimzeg.editorial_system.service.JournalUserDetailsService;  
 import top.tankimzeg.editorial_system.utils.JwtUtil;  
   
 import java.io.IOException;  
   
 /**  
  * @author Kim  
  * @date 2026/1/20 18:37  
  * @description åˆ›å»ºJWTè®¤è¯è¿‡æ»¤å™¨  
  */@Component  
 public class JwtAuthenticationFilter extends OncePerRequestFilter {  
   
     @Autowired  
     private JwtUtil jwtUtil;  
   
     @Autowired  
     private JournalUserDetailsService userDetailsService;  
   
     @Override  
     protected void doFilterInternal(  
             HttpServletRequest request, HttpServletResponse response, FilterChain filterChain  
     ) throws ServletException, IOException {  
         String jwt = parseJwt(request);  
         if (jwt != null && jwtUtil.extractUsername(jwt) != null) {  
             String username = jwtUtil.extractUsername(jwt);  
             UserDetails userDetails = userDetailsService.loadUserByUsername(username);  
   
             if (jwtUtil.validateToken(jwt, userDetails)) {  
                 UsernamePasswordAuthenticationToken authenticationToken =  
                         new UsernamePasswordAuthenticationToken(  
                                 userDetails,  
                                 null,  
                                 userDetails.getAuthorities()  
                         );  
                 authenticationToken.setDetails(userDetails);  
                 // å°†è®¤è¯ä¿¡æ¯å­˜å…¥SecurityContext  
                 SecurityContextHolder.getContext().setAuthentication(authenticationToken);  
             }  
         }  
         filterChain.doFilter(request, response);  
     }  
   
     private String parseJwt(HttpServletRequest request) {  
         String headerAuth = request.getHeader(HttpHeaders.AUTHORIZATION);  
   
         if (StringUtils.hasText(headerAuth) && headerAuth.startsWith("Bearer ")) {  
             return headerAuth.substring(7);  
         }  
   
         return null;  
     }  
 }
 ```

7. åˆ›å»ºSpring Securityé…ç½®

 ```java
 package top.tankimzeg.editorial_system.config;  
   
 import org.springframework.beans.factory.annotation.Autowired;  
 import org.springframework.context.annotation.Bean;  
 import org.springframework.context.annotation.Configuration;  
 import org.springframework.security.authentication.AuthenticationManager;  
 import org.springframework.security.config.Customizer;  
 import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;  
 import org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;  
 import org.springframework.security.config.annotation.web.builders.HttpSecurity;  
 import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;  
 import org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;  
 import org.springframework.security.config.http.SessionCreationPolicy;  
 import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;  
 import org.springframework.security.crypto.password.PasswordEncoder;  
 import org.springframework.security.web.SecurityFilterChain;  
 import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;  
   
   
 /**  
  * @author Kim  
  * @date 2026/1/20 19:12  
  * @description Security configuration for stateless JWT authentication  
  */@Configuration  
 @EnableWebSecurity  
 @EnableMethodSecurity  
 public class SecurityConfig {  
   
     @Autowired  
     private JwtAuthenticationFilter jwtAuthenticationFilter;  
   
     @Bean  
     public SecurityFilterChain filterChain(HttpSecurity http) {  
         http  
                 .cors(Customizer.withDefaults())  
                 .csrf(AbstractHttpConfigurer::disable)  
                 .sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))  
                 .authorizeHttpRequests(auth -> auth  
                         .requestMatchers(  
                                 "/api/auth/**",  
                                 "/swagger-ui/**",  
                                 "/v3/api-docs/**",  
                                 "/doc.html",  
                                 "/webjars/**",  
                                 "/favicon.ico"  
                         ).permitAll()  
                         .anyRequest().authenticated()  
                 );  
   
         // Ensure JWT filter runs before credential-based filter (even if not used)  
         http.addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);  
   
         return http.build();  
     }  
   
     @Bean  
     public AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) {  
         return authenticationConfiguration.getAuthenticationManager();  
     }  
   
     @Bean  
     public PasswordEncoder passwordEncoder() {  
         return new BCryptPasswordEncoder();  
     }  
 }
 ```

8. åˆ›å»ºè®¤è¯Controller

 ```java
 package top.tankimzeg.editorial_system.controller;  
   
 import io.swagger.v3.oas.annotations.Operation;  
 import io.swagger.v3.oas.annotations.tags.Tag;  
 import org.springframework.beans.factory.annotation.Autowired;  
 import org.springframework.http.HttpStatus;  
 import org.springframework.security.authentication.AuthenticationManager;  
 import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;  
 import org.springframework.security.core.Authentication;  
 import org.springframework.security.core.context.SecurityContextHolder;  
 import org.springframework.security.crypto.password.PasswordEncoder;  
 import org.springframework.validation.annotation.Validated;  
 import org.springframework.web.bind.annotation.*;  
 import top.tankimzeg.editorial_system.dto.response.JwtResponse;  
 import top.tankimzeg.editorial_system.dto.request.LoginRequest;  
 import top.tankimzeg.editorial_system.dto.request.RegisterRequest;  
 import top.tankimzeg.editorial_system.entity.JournalUserDetails;  
 import top.tankimzeg.editorial_system.entity.User;  
 import top.tankimzeg.editorial_system.exception.BusinessException;  
 import top.tankimzeg.editorial_system.service.UserService;  
 import top.tankimzeg.editorial_system.utils.JwtUtil;  
   
 import org.springframework.security.core.AuthenticationException;  
 import top.tankimzeg.editorial_system.utils.SecurityUtil;  
 import top.tankimzeg.editorial_system.utils.ApiResponse;  
   
 /**  
  * @author Kim  
  * @date 2026/1/20 21:09  
  * @description ç”¨æˆ·è®¤è¯ç®¡ç†æ§åˆ¶å™¨  
  */@RestController  
 @RequestMapping("/api/auth/user")  
 @Tag(name = "è®¤è¯ç®¡ç†", description = "ç”¨æˆ·ç™»å½•ã€æ³¨å†Œä¸è®¤è¯ç›¸å…³æ¥å£")  
 public class AuthController {  
   
     @Autowired  
     private AuthenticationManager authenticationManager;  
   
     @Autowired  
     private JwtUtil jwtUtil;  
   
     @Autowired  
     private UserService userService;  
   
     @Autowired  
     private PasswordEncoder passwordEncoder;  
   
     @PostMapping("/login")  
     @Operation(summary = "ç”¨æˆ·ç™»å½•", description = "ç”¨æˆ·é€šè¿‡ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œç™»å½•ï¼ŒæˆåŠŸåè¿”å›JWTä»¤ç‰Œ")  
     public ApiResponse<JwtResponse> authenticateUser(  
             @Validated @RequestBody LoginRequest loginRequest  
     ) {  
         try {  
             Authentication authentication = authenticationManager.authenticate(  
                     new UsernamePasswordAuthenticationToken(  
                             loginRequest.getUsername(),  
                             loginRequest.getPassword()  
                     )  
             );  
   
             SecurityContextHolder.getContext().setAuthentication(authentication);  
             JournalUserDetails userDetails = (JournalUserDetails) authentication.getPrincipal();  
             String jwt = jwtUtil.generateToken(userDetails);  
             return ApiResponse.success(  
                     new JwtResponse(  
                             jwt,  
                             userDetails.getId(),  
                             userDetails.getUsername(),  
                             userDetails.getRealName(),  
                             userDetails.getEmail()  
                     ));  
         } catch (AuthenticationException ex) {  
             throw new BusinessException(HttpStatus.UNAUTHORIZED, "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");  
         }  
     }  
   
     @PostMapping("/register")  
     @Operation(summary = "ç”¨æˆ·æ³¨å†Œ", description = "æ–°ç”¨æˆ·æ³¨å†Œæ¥å£")  
     public ApiResponse<JwtResponse> registerUser(  
             @RequestBody RegisterRequest registerRequest  
     ) {  
         if (userService.existsByUsername(registerRequest.getUsername())) {  
             throw new BusinessException("ç”¨æˆ·åå·²è¢«æ³¨å†Œ");  
         }  
         if (userService.existsByEmail(registerRequest.getEmail())) {  
             throw new BusinessException("é‚®ç®±å·²è¢«æ³¨å†Œ");  
         }  
   
         // åˆ›å»ºæ–°ç”¨æˆ·  
         User newUser = new User();  
         newUser.setUsername(registerRequest.getUsername());  
         newUser.setEmail(registerRequest.getEmail());  
         newUser.setRealName(registerRequest.getRealName());  
         newUser.setRole(User.Role.valueOf(registerRequest.getRole().toUpperCase()));  
         newUser.setPassword(passwordEncoder.encode(registerRequest.getPassword()));  
         User createdUser = userService.createAuthor(newUser);  
   
         // è‡ªåŠ¨ç™»å½•  
         Authentication authentication = authenticationManager.authenticate(  
                 new UsernamePasswordAuthenticationToken(  
                         registerRequest.getUsername(),  
                         registerRequest.getPassword()  
                 )  
         );  
         SecurityContextHolder.getContext().setAuthentication(authentication);  
         JournalUserDetails userDetails = (JournalUserDetails) authentication.getPrincipal();  
         String jwt = jwtUtil.generateToken(userDetails);  
         return ApiResponse.success(  
                 new JwtResponse(  
                         jwt,  
                         userDetails.getId(),  
                         userDetails.getUsername(),  
                         userDetails.getRealName(),  
                         userDetails.getEmail()  
                 )  
         );  
     }  
   
     @GetMapping("/me")  
     @Operation(summary = "è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯", description = "è·å–å·²è®¤è¯ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯")  
     public ApiResponse<JournalUserDetails> getCurrentUserInfo() {  
         return ApiResponse.success(SecurityUtil.getCurrentUserDetails()  
                 .orElseThrow(() -> new BusinessException(HttpStatus.UNAUTHORIZED, "æœªè®¤è¯çš„ç”¨æˆ·")));  
     }  
   
 }
 ```

9. åˆ›å»ºå·¥å…·ç±»è·å–å½“å‰ç”¨æˆ·

 ```java
 package top.tankimzeg.editorial_system.utils;  
   
 import org.springframework.security.core.Authentication;  
 import org.springframework.security.core.context.SecurityContextHolder;  
 import org.springframework.stereotype.Component;  
 import top.tankimzeg.editorial_system.entity.JournalUserDetails;  
 import top.tankimzeg.editorial_system.entity.User;  
   
 import java.util.Optional;  
   
 /**  
  * @author Kim  
  * @date 2026/1/20 21:54  
  * @description è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯çš„å·¥å…·ç±»  
  */@Component  
 public class SecurityUtil {  
   
     public static Long getCurrentUserId() {  
         return getCurrentUserDetails()  
                 .orElseThrow()  
                 .getId();  
     }  
   
     public static User.Role getCurrentUserRole() {  
         return getCurrentUserDetails()  
                 .orElseThrow()  
                 .getRole();  
   
     }  
   
     public static String getCurrentUsername() {  
         return getCurrentUserDetails()  
                 .orElseThrow()  
                 .getUsername();  
     }  
   
     public static String getCurrentUserEmail() {  
         return getCurrentUserDetails()  
                 .orElseThrow()  
                 .getEmail();  
     }  
   
     public static String getCurrentUserRealName() {  
         return getCurrentUserDetails()  
                 .orElseThrow()  
                 .getRealName();  
     }  
   
     public static boolean isAuthor() {  
         return getCurrentUserRole().equals(  
                 User.Role.AUTHOR  
         ) || getCurrentUserRole().equals(  
                 User.Role.REVIEWER  
         );  
     }  
   
     public static boolean isEditor() {  
         return getCurrentUserRole().equals(  
                 User.Role.EDITOR  
         );  
     }  
   
     public static boolean isReviewer() {  
         return getCurrentUserRole().equals(  
                 User.Role.REVIEWER  
         );  
     }  
   
     public static Optional<JournalUserDetails> getCurrentUserDetails() {  
         Authentication authentication = SecurityContextHolder.getContext().getAuthentication();  
         if (authentication != null && authentication.isAuthenticated()) {  
             Object principal = authentication.getDetails();  
             if (principal instanceof JournalUserDetails)  
                 return Optional.ofNullable((JournalUserDetails) authentication.getPrincipal());  
         }  
         return Optional.empty();  
     }  
   
 }
 ```

10. æ›´æ–°Knife4jé…ç½®æ”¯æŒJWT

 å‡ ä¹æ‰€æœ‰è¯·æ±‚æ¥å£éƒ½éœ€è¦è®¤è¯ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¢åŠ è¯·æ±‚å¤´éƒ¨çš„è®¾ç½®ï¼Œæˆ‘ç”¨çš„æ–¹æ³•æ˜¯ç›´æ¥å…¨å±€æ–°å¢è¯·æ±‚å¤´éƒ¨ï¼Œä¸éœ€è¦çš„å†åˆ æ‰ã€‚

 ```java
 package top.tankimzeg.editorial_system.config;  
   
 import io.swagger.v3.oas.models.Operation;  
 import io.swagger.v3.oas.models.security.SecurityRequirement;  
 import org.springdoc.core.customizers.GlobalOperationCustomizer;  
 import org.springframework.http.HttpHeaders;  
 import org.springframework.stereotype.Component;  
 import org.springframework.web.method.HandlerMethod;  
   
 import java.util.List;  
   
 /**  
  * @author Kim  
  * @date 2026/1/20 23:24  
  * @description ä¸ºæ‰€æœ‰Knife4jç•Œé¢è°ƒè¯•æ¥å£æ·»åŠ Authorizationè¯·æ±‚å¤´éƒ¨  
  * @see <a href="https://doc.xiaominfo.com/docs/blog/add-authorization-header">OpenAPI3è§„èŒƒä¸­æ·»åŠ Authorizationé‰´æƒè¯·æ±‚</a>  
  */  
 @Component  
 public class Knife4jOperationCustomizer implements GlobalOperationCustomizer {  
     @Override  
     public Operation customize(Operation operation, HandlerMethod handlerMethod) {  
         List<SecurityRequirement> securityRequirements = operation.getSecurity();  
         if (securityRequirements == null) {  
             securityRequirements = List.of(new SecurityRequirement()  
                     .addList(HttpHeaders.AUTHORIZATION));  
             operation.setSecurity(securityRequirements);  
         }  
         return operation;  
     }  
 }
 ```

ç°åœ¨å¯ä»¥åœ¨Controllerä¸­ä½¿ç”¨Â `SecurityUtil.getCurrentUserId()`Â æ¥è·å–å½“å‰ç”¨æˆ·IDã€‚è¿™ä¸€æ•´å¥—æ“ä½œä¸‹æ¥ï¼Œæˆ‘è¿˜æœ‰ç‚¹æ‡µï¼Œä½†çš„ç¡®æ˜¯ç®¡ç”¨çš„ã€‚

## æ¥å£è¿”å›ç»Ÿä¸€æ ¼å¼ä¸å…¨å±€å¼‚å¸¸å¤„ç†

ç»Ÿä¸€å¼‚å¸¸å¤„ç†å’Œå“åº”å°è£…æ˜¯æ„å»ºå¥å£®REST APIçš„å…³é”®ã€‚

å°è£…APIå“åº”ï¼š

```java
package top.tankimzeg.editorial_system.utils;  
  
import lombok.Data;  
import org.springframework.http.HttpStatus;  
import top.tankimzeg.editorial_system.exception.BusinessException;  
  
import java.time.LocalDateTime;  
  
@Data  
public class ApiResponse<T> {  
    private int status;  
    private String message;  
    private T data;  
    private LocalDateTime timestamp;  
  
    public ApiResponse(HttpStatus status, String message, T data) {  
        this.status = status.value();  
        this.message = message;  
        this.data = data;  
        this.timestamp = LocalDateTime.now();  
    }  
  
    public ApiResponse(int code, String message, T data) {  
        this.status = code;  
        this.message = message;  
        this.data = data;  
        this.timestamp = LocalDateTime.now();  
    }  
  
    public static <T> ApiResponse<T> success(T data) {  
        return new ApiResponse<>(HttpStatus.OK, "success", data);  
    }  
  
    public static <T> ApiResponse<T> success(String message, T data) {  
        return new ApiResponse<>(HttpStatus.OK, message, data);  
    }  
  
    public static ApiResponse<?> failure(HttpStatus status, String message) {  
        return new ApiResponse<>(status, message, null);  
    }  
  
    public static <T> ApiResponse<T> failure(HttpStatus status, String message, T data) {  
        return new ApiResponse<>(status, message, data);  
    }  
  
    public static ApiResponse<?> failure(String message) {  
        return new ApiResponse<>(HttpStatus.BAD_REQUEST, message, null);  
    }  
  
    public static ApiResponse<?> fromException(BusinessException ex) {  
        return new ApiResponse<>(ex.getStatus(), ex.getMessage(), null);  
    }  
  
    public static ApiResponse<?> unauthorized(String message) {  
        return new ApiResponse<>(HttpStatus.UNAUTHORIZED, message, null);  
    }  
  
    public static ApiResponse<?> forbidden(String message) {  
        return new ApiResponse<>(HttpStatus.FORBIDDEN, message, null);  
    }  
  
    public static ApiResponse<?> badRequest(String message) {  
        return new ApiResponse<>(HttpStatus.BAD_REQUEST, message, null);  
    }  
  
    public static ApiResponse<?> internalServerError(String message) {  
        return new ApiResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, message, null);  
    }  
}
```

å°è£…ä¸€ä¸ªè‡ªå®šä¹‰çš„å¼‚å¸¸ï¼š

```java
package top.tankimzeg.editorial_system.exception;  
  
import lombok.Getter;  
import org.springframework.http.HttpStatus;  
  
/**  
 * @author Kim  
 * @date 2026/1/21 16:11  
 * @description è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ç±»  
 */@Getter  
public class BusinessException extends RuntimeException{  
  
    private final HttpStatus status;  
  
    private final int code;  
  
    public BusinessException(HttpStatus status, int code, String message){  
        super(message);  
        this.status = status;  
        this.code = code;  
    }  
  
    public BusinessException(String message) {  
        super(message);  
        this.status = HttpStatus.BAD_REQUEST;  
        this.code = HttpStatus.BAD_REQUEST.value();  
    }  
  
    public BusinessException(HttpStatus status, String message){  
        super(message);  
        this.status = status;  
        this.code = status.value();  
    }  
  
    public BusinessException(int code, String message){  
        super(message);  
        this.code = code;  
        this.status = HttpStatus.valueOf(code);  
    }  
  
}
```

å…¨å±€å¼‚å¸¸å¤„ç†ç±»ï¼š

```java
package top.tankimzeg.editorial_system.exception;  
  
import io.swagger.v3.oas.annotations.Hidden;  
import jakarta.validation.ConstraintViolation;  
import jakarta.validation.ConstraintViolationException;  
import org.springframework.http.HttpStatus;  
import org.springframework.security.access.AccessDeniedException;  
import org.springframework.security.authentication.BadCredentialsException;  
import org.springframework.security.core.AuthenticationException;  
import org.springframework.validation.FieldError;  
import org.springframework.web.bind.MethodArgumentNotValidException;  
import org.springframework.web.bind.annotation.ExceptionHandler;  
import org.springframework.web.bind.annotation.RestControllerAdvice;  
import org.springframework.web.method.annotation.MethodArgumentTypeMismatchException;  
import top.tankimzeg.editorial_system.utils.ApiResponse;  
  
import java.util.HashMap;  
import java.util.Map;  
  
/**  
 * @author Kim  
 * @date 2026/1/21 16:48  
 * @description å…¨å±€å¼‚å¸¸å¤„ç†å™¨  
 */@Hidden  
@RestControllerAdvice()  
public class GlobalExceptionHandler {  
  
    // å¤„ç†ä¸šåŠ¡å¼‚å¸¸  
    @ExceptionHandler(BusinessException.class)  
    public ApiResponse<?> handleBusinessException(BusinessException ex) {  
  
        return ApiResponse.fromException(ex);  
    }  
  
    // å¤„ç†å‚æ•°éªŒè¯å¼‚å¸¸  
    @ExceptionHandler(MethodArgumentNotValidException.class)  
    public ApiResponse<?> handleValidationExceptions(MethodArgumentNotValidException ex) {  
  
        Map<String, String> errors = new HashMap<>();  
        ex.getBindingResult().getAllErrors().forEach(error -> {  
            String fieldName = ((FieldError) error).getField();  
            String errorMessage = error.getDefaultMessage();  
            errors.put(fieldName, errorMessage);  
        });  
  
        return ApiResponse.failure(HttpStatus.BAD_REQUEST, "å‚æ•°éªŒè¯å¤±è´¥", errors);  
    }  
  
    // å¤„ç†JSR303éªŒè¯å¼‚å¸¸  
    @ExceptionHandler(ConstraintViolationException.class)  
    public ApiResponse<?> handleConstraintViolationException(ConstraintViolationException ex) {  
  
        Map<String, String> errors = new HashMap<>();  
        for (ConstraintViolation<?> violation : ex.getConstraintViolations()) {  
            String fieldName = violation.getPropertyPath().toString();  
            String errorMessage = violation.getMessage();  
            errors.put(fieldName, errorMessage);  
        }  
  
        return ApiResponse.failure(HttpStatus.BAD_REQUEST, "å‚æ•°éªŒè¯å¤±è´¥", errors);  
    }  
  
    // å¤„ç†è®¤è¯å¼‚å¸¸  
    @ExceptionHandler({AuthenticationException.class, BadCredentialsException.class})  
    public ApiResponse<?> handleAuthenticationException(Exception ex) {  
  
        return ApiResponse.unauthorized("è®¤è¯å¤±è´¥: " + ex.getMessage());  
    }  
  
    // å¤„ç†æƒé™ä¸è¶³å¼‚å¸¸  
    @ExceptionHandler(AccessDeniedException.class)  
    public ApiResponse<?> handleAccessDeniedException(AccessDeniedException ex) {  
  
        return ApiResponse.forbidden("æƒé™ä¸è¶³: " + ex.getMessage());  
    }  
  
    // å¤„ç†å‚æ•°ç±»å‹ä¸åŒ¹é…å¼‚å¸¸  
    @ExceptionHandler(MethodArgumentTypeMismatchException.class)  
    public ApiResponse<?> handleMethodArgumentTypeMismatchException(MethodArgumentTypeMismatchException ex) {  
  
        String error = String.format("å‚æ•° '%s' ç±»å‹é”™è¯¯ï¼ŒæœŸæœ›ç±»å‹: %s",  
                ex.getName(), ex.getRequiredType().getSimpleName());  
  
        return ApiResponse.badRequest(error);  
    }  
  
    // å¤„ç†å…¶ä»–æ‰€æœ‰å¼‚å¸¸  
    @ExceptionHandler(Exception.class)  
    public ApiResponse<?> handleAllUncaughtException(Exception ex) {  
  
        return ApiResponse.internalServerError(ex.getMessage());  
    }  
}
```

## è®¾è®¡å¹¶å®Œå–„è§†å›¾

åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸¥æ ¼åŒºåˆ†è¿™äº›å±‚æ¬¡éå¸¸é‡è¦ã€‚

> ğŸ“Š ä¸ºä»€ä¹ˆéœ€è¦åŒºåˆ†DTO/VO/Entityï¼Ÿ

|å±‚æ¬¡|ç›®çš„|ç¤ºä¾‹|ç‰¹ç‚¹|
|---|---|---|---|
|**Entity**|æ•°æ®åº“æ˜ å°„ï¼Œæ ¸å¿ƒä¸šåŠ¡å¯¹è±¡|`User`,Â `Manuscript`|åŒ…å«æ•°æ®åº“å­—æ®µæ˜ å°„ã€å…³è”å…³ç³»ã€ä¸šåŠ¡é€»è¾‘æ–¹æ³•|
|**DTO**|æ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œç”¨äºAPIæ¥æ”¶|`CreateManuscriptDTO`|ä»…åŒ…å«å®¢æˆ·ç«¯éœ€è¦æäº¤çš„å­—æ®µï¼Œç”¨äºå‚æ•°æ ¡éªŒ|
|**VO**|è§†å›¾å¯¹è±¡ï¼Œç”¨äºAPIè¿”å›|`ManuscriptVO`|åŒ…å«å®¢æˆ·ç«¯éœ€è¦å±•ç¤ºçš„å­—æ®µï¼Œå¯èƒ½åŒ…å«è®¡ç®—å­—æ®µã€æ ¼å¼åŒ–æ•°æ®|

æˆ‘éµå¾ªä¼ å…¥DTOï¼Œè¿”å›VOçš„è§„èŒƒï¼Œè®¾è®¡äº†DTOå’ŒVOçš„å­—æ®µã€‚ç„¶è€Œï¼Œåœ¨DTO,Entityå’ŒVOä¹‹é—´çš„è½¬æ¢æ—¶é‡åˆ°äº†éº»çƒ¦ã€‚æˆ‘æœ€å¼€å§‹ç”¨çš„æ˜¯ `BeanUtils.copyProperties();`ï¼Œå¾ˆå¿«å°±åŠ›ä¸ä»å¿ƒäº†ã€‚è¿™æ—¶å€™æˆ‘é‡åˆ°äº†MapStructã€‚

MapStruct æ˜¯ä¸€ä¸ª Java çš„ä»£ç ç”Ÿæˆåº“ï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆ DTO å’Œ VO ä¹‹é—´çš„è½¬æ¢ä»£ç ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ï¼š

- æ— éœ€æ‰‹åŠ¨ç¼–å†™è½¬æ¢é€»è¾‘ã€‚
- ç¼–è¯‘æ—¶ç”Ÿæˆä»£ç ï¼Œæ€§èƒ½é«˜ã€‚
- æ”¯æŒå¤æ‚çš„æ˜ å°„è§„åˆ™ã€‚

```java
package top.tankimzeg.editorial_system.mapper;  
  
import org.mapstruct.BeanMapping;  
import org.mapstruct.Mapper;  
import org.mapstruct.Mapping;  
import org.mapstruct.MappingTarget;  
import org.mapstruct.NullValuePropertyMappingStrategy;  
import org.mapstruct.factory.Mappers;  
import top.tankimzeg.editorial_system.dto.request.ManuscriptDTO;  
import top.tankimzeg.editorial_system.dto.response.ManuscriptVO;  
import top.tankimzeg.editorial_system.entity.Manuscript;  
  
/**  
 * @author Kim  
 * @date 2026/1/22 21:29  
 * @description ç¨¿ä»¶æ˜ å°„å™¨  
 */@Mapper  
public interface ManuscriptMapper {  
  
    ManuscriptMapper INSTANCE = Mappers.getMapper(ManuscriptMapper.class);  
  
    // create mapping: ignore server-managed or foreign key fields  
    @Mapping(target = "id", ignore = true)  
    @Mapping(target = "status", ignore = true)  
    @Mapping(target = "author", ignore = true)  
    @Mapping(target = "submittedAt", ignore = true)  
    @Mapping(target = "updatedAt", ignore = true)  
    @Mapping(target = "manuscriptProcesses", ignore = true)  
    @Mapping(target = "attachments", ignore = true)  
    Manuscript dtoToEntity(ManuscriptDTO dto);  
  
    // patch/update mapping: ignore nulls so they don't overwrite; also ignore server-managed fields  
    @BeanMapping(nullValuePropertyMappingStrategy = NullValuePropertyMappingStrategy.IGNORE)  
    @Mapping(target = "id", ignore = true)  
    @Mapping(target = "status", ignore = true)  
    @Mapping(target = "author", ignore = true)  
    @Mapping(target = "submittedAt", ignore = true)  
    @Mapping(target = "updatedAt", ignore = true)  
    @Mapping(target = "manuscriptProcesses", ignore = true)  
    @Mapping(target = "attachments", ignore = true)  
    void updateEntityFromDto(ManuscriptDTO dto, @MappingTarget Manuscript entity);  
  
    // entity -> vo mapping  
    @Mapping(target = "attachmentIds", expression =  
            "java(entity.getAttachments().stream().map(att -> att.getId()).toList())")  
    @Mapping(target = "authors", expression =  
            "java(java.util.Collections.singletonList(entity.getAuthor().getRealName()))")  
    @Mapping(target = "status", expression = "java(entity.getStatus().name())")  
    ManuscriptVO entityToVO(Manuscript entity);  
  
}
```

ä¹Ÿæ”¯æŒæ‰‹åŠ¨ç¼–å†™è½¬æ¢ä»£ç ï¼š

```java
package top.tankimzeg.editorial_system.mapper;  
  
import org.mapstruct.Mapper;  
import org.mapstruct.factory.Mappers;  
import org.springframework.beans.factory.annotation.Autowired;  
import top.tankimzeg.editorial_system.dto.response.ManuscriptProcessVO;  
import top.tankimzeg.editorial_system.entity.ManuscriptProcess;  
import top.tankimzeg.editorial_system.repository.ReviewRepo;  
import top.tankimzeg.editorial_system.repository.RevisionRepo;  
  
  
import java.time.format.DateTimeFormatter;  
  
/**  
 * @author Kim  
 * @date 2026/1/23 15:41  
 * @description ç¨¿ä»¶å¤„ç†æµç¨‹æ˜ å°„å™¨  
 */@Mapper  
public interface ManuscriptProcessMapper {  
  
    ManuscriptProcessMapper INSTANCE = Mappers.getMapper(ManuscriptProcessMapper.class);  
  
    default ManuscriptProcessVO entityToVO(  
            ManuscriptProcess entity, @Autowired RevisionRepo revisionRepo, ReviewRepo reviewRepo) {  
        if (entity == null)  
            return null;  
        ManuscriptProcessVO vo = new ManuscriptProcessVO();  
        vo.setId(entity.getId());  
        vo.setStage(entity.getStage().name());  
        vo.setProcessedAt(entity.getProcessedAt().format(DateTimeFormatter.ISO_DATE));  
        vo.setFinishedAt(entity.getFinishedAt() != null ?  
                entity.getFinishedAt().format(DateTimeFormatter.ISO_DATE) : null);  
        vo.setComments(entity.getComments());  
        vo.setProcessedByRole(entity.getProcessedBy().getRole().name());  
        switch (entity.getStage()) {  
            case REVISION -> revisionRepo.findRevisionByProcessId(entity.getId()).getAttachments().forEach(  
                    attachment -> vo.getAttachments().add(attachment.getId())  
            );  
  
            case PEER_REVIEW -> reviewRepo.findReviewByProcessId(entity.getId()).getAttachments().forEach(  
                    attachment -> vo.getAttachments().add(attachment.getId())  
            );  
  
        }  
        return vo;  
    }  
}
```

æ„å»ºåç”Ÿæˆå„è‡ªçš„å®ç°ä»£ç ã€‚

## ç”µå­é‚®ä»¶é€šçŸ¥åŠŸèƒ½

é™¤äº†åœ¨ç³»ç»Ÿä¸­æœ‰æ¥å£èƒ½å¤ŸæŸ¥è¯¢è‡ªå·±ç›®å‰å¾…åŠçš„ä»»åŠ¡å¤–ï¼Œç¨¿ä»¶å®¡ç†æœŸé—´è¿˜æœ‰é‚®ä»¶æœåŠ¡ï¼Œæé†’ä½œè€…ç¼´çº³å®¡ç†è´¹ç”¨ã€ä¿®æ”¹ç¨¿ä»¶ï¼Œæé†’å®¡ç¨¿ä¸“å®¶å®¡ç†ç¨¿ä»¶ç­‰ã€‚ä¸ºäº†å®ç°è¿™ä¸€éœ€æ±‚ï¼Œå¼•å…¥JavaMailä¸äº‹ä»¶ç›‘å¬å™¨ã€‚

é¦–å…ˆæ·»åŠ é‚®ä»¶æœåŠ¡ä¹Ÿæ¨¡æ¿å¼•æ“ï¼š

```xml
<!-- é‚®ä»¶å‘é€ -->  
<dependency>  
    <groupId>org.springframework.boot</groupId>  
    <artifactId>spring-boot-starter-mail</artifactId>  
</dependency>  
  
<!-- Thymeleaf -->  
<dependency>  
    <groupId>org.thymeleaf</groupId>  
    <artifactId>thymeleaf-spring6</artifactId>  
    <version>3.1.2.RELEASE</version>  
</dependency>  
  
<dependency>  
    <groupId>com.icegreen</groupId>  
    <artifactId>greenmail-junit5</artifactId>  
    <version>2.1.8</version>  
    <scope>test</scope>  
</dependency>
```

è‡ªå®šä¹‰ä¸€ä¸ªé€šçŸ¥æœåŠ¡æ¥å£ï¼Œå¹¶ä»¥é‚®ä»¶é€šçŸ¥æœåŠ¡å®ç°æ¥å£ï¼š

```java
package top.tankimzeg.editorial_system.service.impl;  
  
import lombok.extern.slf4j.Slf4j;  
import org.springframework.beans.factory.annotation.Value;  
import org.springframework.mail.SimpleMailMessage;  
import org.springframework.mail.javamail.JavaMailSender;  
import org.springframework.mail.javamail.MimeMessageHelper;  
import org.springframework.scheduling.annotation.Async;  
import org.springframework.stereotype.Service;  
import top.tankimzeg.editorial_system.service.NotificationService;  
  
import jakarta.mail.MessagingException;  
import jakarta.mail.internet.MimeMessage;  
  
@Slf4j  
@Service  
public class MailNotificationService implements NotificationService {  
  
    private final JavaMailSender mailSender;  
  
    @Value("${spring.mail.username}")  
    private String from;  
  
    public MailNotificationService(JavaMailSender mailSender) {  
        this.mailSender = mailSender;  
    }  
  
    @Async  
    @Override    public void send(String to, String subject, String content) {  
        SimpleMailMessage message = new SimpleMailMessage();  
        message.setFrom(from);  
        message.setTo(to);  
        message.setSubject(subject);  
        message.setText(content);  
        try {  
            mailSender.send(message);  
        } catch (Exception e) {  
            log.error("Failed to send email to {}: {}", to, e.getMessage(), e);  
        }  
    }  
  
    @Async  
    @Override    public void sendHtml(String to, String subject, String html) {  
        MimeMessage mimeMessage = mailSender.createMimeMessage();  
        try {  
            MimeMessageHelper helper = new MimeMessageHelper(mimeMessage, true, "UTF-8");  
            helper.setFrom(from);  
            helper.setTo(to);  
            helper.setSubject(subject);  
            helper.setText(html, true);  
            mailSender.send(mimeMessage);  
        } catch (MessagingException e) {  
            log.error("Failed to send HTML email to {}: {}", to, e.getMessage(), e);  
        }  
    }  
}
```

ä»ä¾¿äºç»´æŠ¤å’Œå¯æ‹“å±•æ€§çš„è§’åº¦æ¥çœ‹ï¼Œä½¿ç”¨äº‹ä»¶ç›‘å¬å™¨æ›´å¥½ï¼Œè€Œä¸æ˜¯åœ¨åˆ«çš„æœåŠ¡çš„æ–¹æ³•é‡Œé¢æ’å…¥å‘é€é‚®ä»¶ä»£ç ã€‚å› æ­¤åˆ›å»ºäº‹ä»¶ç›‘å¬å™¨ä»¥åŠç›¸åº”çš„äº‹ä»¶ï¼š

```java
package top.tankimzeg.editorial_system.listener;  
  
import lombok.RequiredArgsConstructor;  
import org.springframework.stereotype.Component;  
import org.springframework.transaction.event.TransactionPhase;  
import org.springframework.transaction.event.TransactionalEventListener;  
import org.thymeleaf.TemplateEngine;  
import org.thymeleaf.context.Context;  
import top.tankimzeg.editorial_system.events.*;  
import top.tankimzeg.editorial_system.service.NotificationService;  
  
@Component  
@RequiredArgsConstructor  
public class NotificationEventListener {  
  
    private final NotificationService notificationService;  
    private final TemplateEngine templateEngine;  
  
    // ------------------- ç»™ä½œè€…å‘é€é€šçŸ¥ -------------------  
  
    @TransactionalEventListener  
    public void onManuscriptSubmitted(ManuscriptSubmittedEvent event) {  
        var manuscript = event.manuscript();  
        Context ctx = new Context();  
        ctx.setVariable("title", manuscript.getTitle());  
        ctx.setVariable("author", manuscript.getAuthor().getRealName());  
        String html = templateEngine.process("mail/manuscript-submitted", ctx);  
        notificationService.sendHtml(manuscript.getAuthor().getEmail(), "ç¨¿ä»¶å·²æäº¤", html);  
    }  
  
    @TransactionalEventListener  
    public void onRevisionRequested(RevisionTaskEvent event) {  
        var process = event.process();  
        Context ctx = new Context();  
        ctx.setVariable("title", process.getManuscript().getTitle());  
        String html = templateEngine.process("mail/revision-requested", ctx);  
        notificationService.sendHtml(process.getManuscript().getAuthor().getEmail(), "ç¨¿ä»¶ä¿®æ”¹é€šçŸ¥", html);  
    }  
  
    @TransactionalEventListener  
    public void onReviewDecisionFinalized(FinishedReviewDecisionEvent event) {  
        var manuscript = event.manuscript();  
        var review = event.review();  
        Context ctx = new Context();  
        ctx.setVariable("title", manuscript.getTitle());  
        ctx.setVariable("decision", review.getDecision().name());  
        String html = templateEngine.process("mail/final-decision", ctx);  
        notificationService.sendHtml(manuscript.getAuthor().getEmail(), "å®¡ç¨¿ç»“æœé€šçŸ¥", html);  
    }  
  
    @TransactionalEventListener  
    public void onInitialReviewFinished(FinishedInitialReviewEvent event) {  
        var manuscript = event.manuscript();  
        Context ctx = new Context();  
        ctx.setVariable("title", manuscript.getTitle());  
        String html = templateEngine.process("mail/initial-review-finished", ctx);  
        notificationService.sendHtml(manuscript.getAuthor().getEmail(), "åˆå®¡ç»“æœé€šçŸ¥", html);  
    }  
  
    @TransactionalEventListener  
    public void onSelfRecommendationApproved(SelfRecommendationApprovedEvent event) {  
        var rec = event.recommendation();  
        Context ctx = new Context();  
        ctx.setVariable("expert", rec.getApprover());  
        String html = templateEngine.process("mail/self-recommendation-approved", ctx);  
        notificationService.sendHtml(rec.getApplicant().getEmail(), "è‡ªèä¸“å®¶å®¡æ ¸", html);  
    }  
  
  
    // ------------------- ç»™å®¡ç¨¿äººå‘é€é€šçŸ¥ -------------------  
  
    @TransactionalEventListener  
    public void onReviewAssigned(ReviewTaskEvent event) {  
        var process = event.process();  
        Context ctx = new Context();  
        ctx.setVariable("title", process.getManuscript().getTitle());  
        ctx.setVariable("reviewer", process.getProcessedBy().getRealName());  
        String html = templateEngine.process("mail/review-assigned", ctx);  
        notificationService.sendHtml(process.getProcessedBy().getEmail(), "æ‚¨æœ‰æ–°çš„ç¨¿ä»¶éœ€è¦è¯„å®¡", html);  
  
    }  
  
    // ------------------- ç»™ç¼–è¾‘å‘é€é€šçŸ¥ -------------------  
  
    @TransactionalEventListener  
    public void onEditorDealProcess(EditorTaskEvent event) {  
        var process = event.process();  
        Context ctx = new Context();  
        ctx.setVariable("title", process.getManuscript().getTitle());  
        ctx.setVariable("editor", process.getProcessedBy().getRealName());  
        String html = templateEngine.process("mail/editor-deal-process", ctx);  
        notificationService.sendHtml(process.getProcessedBy().getEmail(), "ç¨¿ä»¶å¤„ç†æé†’", html);  
    }  
  
    @TransactionalEventListener  
    public void onSelfRecommendationApply(SelfRecommendationApplyEvent event) {  
        var rec = event.recommendation();  
        Context ctx = new Context();  
        ctx.setVariable("applicant", rec.getApplicant().getRealName());  
        String html = templateEngine.process("mail/self-recommendation-apply", ctx);  
        notificationService.sendHtml(rec.getApprover().getEmail(), "æœ‰æ–°çš„è‡ªèä¸“å®¶ç”³è¯·å¾…å¤„ç†", html);  
    }  
}
```

è¿™æ ·å°±å®ç°äº†å¯¹ä¸åŒäº‹ä»¶çš„æ•è·ä¸å¤„ç†é€»è¾‘ã€‚åŒæ—¶ï¼Œä½¿ç”¨äº† `thymeleaf` æ¥ç®¡ç†æ¨¡æ¿ã€‚

æ¨¡æ¿å¼•æ“çš„é…ç½®ç±»ï¼š

```java
package top.tankimzeg.editorial_system.config;  
  
import org.springframework.context.annotation.Bean;  
import org.springframework.context.annotation.Configuration;  
import org.thymeleaf.TemplateEngine;  
import org.thymeleaf.spring6.SpringTemplateEngine;  
import org.thymeleaf.spring6.templateresolver.SpringResourceTemplateResolver;  
  
@Configuration  
public class ThymeleafConfig {  
  
    @Bean  
    public SpringResourceTemplateResolver thymeleafTemplateResolver() {  
        SpringResourceTemplateResolver resolver = new SpringResourceTemplateResolver();  
        resolver.setPrefix("classpath:/templates/");  
        resolver.setSuffix(".html");  
        resolver.setCharacterEncoding("UTF-8");  
        resolver.setTemplateMode("HTML");  
        resolver.setCacheable(true);  
        return resolver;  
    }  
  
    @Bean  
    public TemplateEngine templateEngine(SpringResourceTemplateResolver resolver) {  
        SpringTemplateEngine engine = new SpringTemplateEngine();  
        engine.setTemplateResolver(resolver);  
        return engine;  
    }  
}
```

åœ¨æŸServiceä¸‹å°±å¯ä»¥ç”¨ä¸€è¡Œä»£ç è§¦å‘äº‹ä»¶å‘å¸ƒï¼š

```java
package top.tankimzeg.editorial_system.service;  
  
import org.springframework.beans.factory.annotation.Autowired;  
import org.springframework.context.ApplicationEventPublisher;  
import org.springframework.stereotype.Service;  
import org.springframework.transaction.annotation.Transactional;  
import org.springframework.web.multipart.MultipartFile;  
import top.tankimzeg.editorial_system.dto.request.ReviewDTO;  
import top.tankimzeg.editorial_system.dto.response.ManuscriptProcessVO;  
import top.tankimzeg.editorial_system.dto.response.ReviewVO;  
import top.tankimzeg.editorial_system.entity.Manuscript;  
import top.tankimzeg.editorial_system.entity.ManuscriptProcess;  
import top.tankimzeg.editorial_system.entity.Review;  
import top.tankimzeg.editorial_system.events.FinishedInitialReviewEvent;  
import top.tankimzeg.editorial_system.events.FinishedReviewDecisionEvent;  
import top.tankimzeg.editorial_system.mapper.ManuscriptProcessMapper;  
import top.tankimzeg.editorial_system.mapper.ReviewRecordMapper;  
import top.tankimzeg.editorial_system.repository.ManuscriptProcessRepo;  
import top.tankimzeg.editorial_system.repository.ManuscriptRepo;  
import top.tankimzeg.editorial_system.repository.ReviewRepo;  
  
import java.io.IOException;  
import java.time.LocalDateTime;  
import java.util.List;  
  
/**  
 * @author Kim  
 * @date 2026/1/19 16:15  
 * @description è¯„å®¡æœåŠ¡ç±»  
 */@Service  
public class ReviewService {  
  
    @Autowired  
    private ManuscriptRepo manuscriptRepo;  
  
    @Autowired  
    private ManuscriptProcessRepo manuscriptProcessRepo;  
  
    @Autowired  
    private ReviewRepo reviewRepo;  
  
    @Autowired  
    private FileStorageService fileStorageService;  
  
    @Autowired  
    private ApplicationEventPublisher eventPublisher;  
  
    private static final ManuscriptProcessMapper processMapper = ManuscriptProcessMapper.INSTANCE;  
  
    private static final ReviewRecordMapper reviewMapper = ReviewRecordMapper.INSTANCE;

 /**  
  * ç¼–è¾‘å®Œæˆæœ€ç»ˆå†³å®šï¼Œç¼–è¾‘åšå‡ºæ¥å—æˆ–æ‹’ç»çš„æœ€ç»ˆå†³å®šåè°ƒç”¨æ­¤æ–¹æ³• 
  * 
  * @param processId     ç¨¿ä»¶å¤„ç†æµç¨‹ID  
  * @param finalDecision æœ€ç»ˆå†³å®šçŠ¶æ€  
  * @param comment       å¤‡æ³¨  
  * @return æ›´æ–°åçš„ç¨¿ä»¶å¤„ç†æµç¨‹è®°å½•  
  */
  @Transactional  
 public ManuscriptProcessVO finishedFinalDecision(  
         Long processId, Manuscript.ManuscriptStatus finalDecision, String comment) {  
     ManuscriptProcess process = manuscriptProcessRepo.getReferenceById(processId);  
     if (!process.getStage().equals(ManuscriptProcess.Stage.FINAL_DECISION))  
         throw new RuntimeException("å½“å‰æµç¨‹é˜¶æ®µä¸å…è®¸åšæœ€ç»ˆå†³å®š");  
   
     switch (finalDecision) {  
         case ACCEPTED, REJECTED -> {  
             // æ›´æ–°ç¨¿ä»¶çŠ¶æ€ä¸ºæœ€ç»ˆå†³å®šçŠ¶æ€  
             Manuscript manuscript = process.getManuscript();  
             manuscript.setStatus(finalDecision);  
             Manuscript saved = manuscriptRepo.save(manuscript);  
   
             // æ›´æ–°ç¨¿ä»¶å¤„ç†æµç¨‹è®°å½•  
             process.setComments(comment);  
             process.setFinishedAt(LocalDateTime.now());  
             ManuscriptProcessVO vo = processMapper.entityToVO(manuscriptProcessRepo.save(process), null, null);  
             // å‘å¸ƒæœ€ç»ˆå†³å®šå®Œæˆäº‹ä»¶ï¼Œé€šçŸ¥ä½œè€…  
             eventPublisher.publishEvent(new FinishedReviewDecisionEvent(saved, reviewRepo.findReviewByProcessId(processId)));  
             return vo;  
         }  
         default -> throw new RuntimeException("æœ€ç»ˆå†³å®šåªèƒ½æ˜¯æ¥å—æˆ–æ‹’ç»");  
     }  
 }
}
```

## å¼€å‘æ—¥å¿—

ä»¥ä¸‹æ˜¯å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„å…·ä½“é—®é¢˜ï¼Œå¹¶å«æœ‰è§£å†³æªæ–½å‚è€ƒã€‚

### DAY 1

ä»Šå¤©åˆ›å»ºå¹¶è¿è¡Œåˆå§‹é¡¹ç›®ã€‚é˜…è¯»äº†Springå®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£äº†Springæ¡†æ¶ä»¥åŠå‡ ä¸ªæ³¨è§£ã€‚

### DAY 2

ä»Šå¤©ä¸»è¦è®¾è®¡äº†å‡ ä¸ªæ•°æ®è¡¨ï¼Œå­¦ä¹ æ€ä¹ˆå†™Jpa Repositoryã€‚

### DAY 3

ä»Šå¤©å®Œå–„äº†æ•°æ®è¡¨ï¼Œç¼–å†™äº†æ•°æ®è®¿é—®å±‚å’ŒæœåŠ¡å±‚ï¼ŒåŸºæœ¬å®Œæˆè¿™äº›åŸºç¡€è®¾æ–½çš„æ„å»ºï¼Œå°±å·®æ§åˆ¶å™¨å±‚äº†â€¦â€¦

å®ä½“å’Œæ•°æ®è®¿é—®å±‚ç”¨äº†Jpaï¼Œè¿™å‡ å¤©éƒ½åœ¨æ…¢æ…¢å­¦ä¹ ï¼Œä¸€å¼€å§‹ä¸ä¹ æƒ¯ï¼Œåœ¨å­¦ç”¨æœŸé—´é¡ºå¸¦é‡æ¸©äº†æ•°æ®åº“åŸç†ğŸ™„ä¼šç”¨äº†ä¹‹åå‘ç°çœŸçš„å¥½ç”¨ï¼ŒSpringå…¨å®¶æ¡¶å°±åº”è¯¥å¸¦ç»™äººè¿™ç§æ„Ÿè§‰ï¼Œå›½å†…å–œæ¬¢ç”¨MyBatisï¼Œæé‚£åº“åº“æ‰‹å†™SQLï¼ŒæŠ½è±¡æ°´å¹³ä¹‹å·®ï¼Œä»¤äººæ±—é¢œï¼ä¸ºä»€ä¹ˆä¸ç”¨Jpaå‘¢ï¼ŸåŸ¹è®­ç­å‡ºæ¥çš„ä¸šåŠ¡å‘˜ï¼ŒæŠŠå†™ä»£ç å˜æˆäº†ä½“åŠ›æ´»ï¼ŒçœŸçš„è·Ÿå·¥åœ°æ¬ç –æ²¡æœ‰åŒºåˆ«ã€‚ä¸ºä»€ä¹ˆå›½å†…ä¸æµè¡ŒJpaè€Œæ˜¯My-Batiså‘¢ï¼Ÿæ•°æ®åº“è®¾è®¡ç†å¿µé—¨æ§›è¾ƒé«˜ï¼Œæœ‰äººæ²¡æœ‰æŒæ¡ã€‚ç”¨Jpaæ ·æ¿ä»£ç å‡å°‘äº†ï¼Œä¸ç”¨æ‰‹åŠ¨åˆ›å»ºæ•°æ®è¡¨äº†ï¼ŒåŒ…ã€ç±»çš„æ•°é‡å‡å°‘äº†ï¼Œå¯ç»´æŠ¤æ€§å¤§å¤§æå‡ã€‚

[SpringBootå¼€å‘ä½¿ç”¨Mybatisè¿˜æ˜¯Spring Data JPA??](https://www.zhihu.com/question/316458408)

### DAY 4

åœ¨ç¼–å†™controllerä¹‹å‰ï¼Œå…ˆå®ç°ç”¨æˆ·ç™»å½•è®¤è¯æˆæƒæ§åˆ¶ã€‚éå¸¸å¤æ‚ï¼Œå€ŸåŠ©äº†AIç¼–å†™çš„ä»£ç å’Œé…ç½®ï¼ŒåŠ ä¸Šè‡ªå·±è°ƒè¯•æ‰æå¥½ã€‚

å­¦ä¹ äº†[jwt](https://javaguide.cn/system-design/security/jwt-intro.html),[ä¸€æ–‡è¯»æ‡‚jwt](https://zhuanlan.zhihu.com/p/1932939645169164990)

ç™»å½•æ³¨å†ŒController APIâ€¦â€¦

çœ‹äº†è¿™ç¯‡ <https://blog.csdn.net/weixin_42609405/article/details/139275959>
å’Œ <https://doc.xiaominfo.com/docs/blog/add-authorization-header> æ‰å¼„å¥½Knife4jçš„è°ƒè¯•æ¥å£è¯·æ±‚å¤´éƒ¨ã€‚

![ç”¨æˆ·æ³¨å†Œ](./attachments/Springé¡¹ç›®ï¼šæœŸåˆŠåœ¨çº¿ç¨¿ä»¶ç®¡ç†ç³»ç»Ÿ-1768961021787.png)

![è·å–ç”¨æˆ·](./attachments/Springé¡¹ç›®ï¼šæœŸåˆŠåœ¨çº¿ç¨¿ä»¶ç®¡ç†ç³»ç»Ÿ-1768961080649.png)

### DAY 5

æ—©ä¸Šç¼–å†™äº†å¤§é‡controllerå’Œé‰´æƒä»£ç ï¼Œå·²ç»åŸºæœ¬å®Œæˆä¸»ä½“é€»è¾‘çš„ç¼–å†™ã€‚

ä¸‹åˆå¼€å§‹é€æ­¥æ›¿æ¢DTOå’ŒVOçš„å·¥ä½œã€‚

é¦–å…ˆæ˜¯å°è£… `ResponseEntity`ã€‚ä¸ºäº†ä¾¿äºå‰ç«¯çš„å¼€å‘ï¼Œåº”è¯¥ç»Ÿä¸€æœåŠ¡å™¨å“åº”çš„æ ¼å¼ã€‚

å¯¹äºè¯·æ±‚å¼‚å¸¸ï¼Œä¹Ÿè¦åŒ…è£…èµ·æ¥è¿”å›ç›¸å…³ä¿¡æ¯ã€‚è¿™å°±å¼•å…¥äº†å…¨å±€å¼‚å¸¸å¤„ç†ã€‚æ•è·å…¨å±€å¼‚å¸¸ç„¶åè¿”å›å¯¹åº”çš„å“åº”ã€‚

ç»“æœè®¾ç½®äº† `@RestControllerAdvice` å kinfe4jæœ‰ä¸€äº›é—®é¢˜ï¼š

```
java.lang.NoSuchMethodError: 'void org.springframework.web.method.ControllerAdviceBean.<init>(java.lang.Object)'
 at org.springdoc.core.service.GenericResponseService.lambda$getGenericMapResponse$8(GenericResponseService.java:702) 
```

æ‰¾åˆ°äº†è§£å†³æ–¹æ³•ï¼š <https://blog.csdn.net/m0_63131933/article/details/145346217> ä¸æ˜è§‰å‰â€¦â€¦

ç°åœ¨å‘ç”Ÿå¼‚å¸¸ä¹Ÿæœ‰è¿”å›å“åº”äº†ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š

![å¼‚å¸¸ç›¸åº”](./attachments/Springé¡¹ç›®ï¼šæœŸåˆŠåœ¨çº¿ç¨¿ä»¶ç®¡ç†ç³»ç»Ÿ-1768989497166.png)

çœŸçš„æœ‰æ¨¡æœ‰æ ·äº†ï¼

### DAY 6

ä»Šå¤©å®Œæˆäº†æ‰€æœ‰controlleræ¥å£çš„ç»Ÿä¸€å°è£…ã€‚ç”¨åˆ°äº†ä¸€ä¸ªSpring Securityæ³¨è§£ `@PreAuthorize`ã€‚

DTOçš„è½¬æ¢å¥½éº»çƒ¦å•Šï¼Œæˆ‘ä»¥å‰ç”¨çš„æ˜¯`BeanUtil.transform`ï¼Œä¸çŸ¥é“æ˜¯è°å°è£…çš„ï¼Œç°åœ¨æ‰¾ä¸åˆ°åŒ…äº†ã€‚è¿˜æœ‰ä»¥å‰ç”¨çš„Entity/DTO/VOè®¾è®¡å¾ˆä¸ä¼˜é›…ï¼Œå„ç§ç»§æ‰¿ä¹±æˆä¸€å›¢ã€‚

ç°åœ¨æˆ‘æ·±å…¥ç†è§£äº†å®ƒä»¬çš„åŒºåˆ«ï¼Œå¹¶ä¸”äº†è§£åˆ°[MapStruct](https://www.cnblogs.com/homejim/p/11313128.html)ï¼Œè¿™ä¸ªçœ‹èµ·æ¥æ¯”è¾ƒå¥½ç”¨ã€‚

<https://blog.csdn.net/Gold_exp_erience/article/details/144005460>

### DAY 7

æ–°å¢é™„ä»¶ä¸Šä¼ åŠŸèƒ½ã€‚`MultipartFile`æ–‡ä»¶ä¼ å…¥ `controller` çš„å‚æ•°æ³¨è§£è¿™é‡Œæœç„¶æœ‰å‘ï¼š
<https://blog.csdn.net/qq_19891197/article/details/128653537>
<https://www.cnblogs.com/deanCopy/p/16358469.html>
<https://zhuanlan.zhihu.com/p/715695734>
æˆ‘æ²¡æœ‰ç”¨postmanæµ‹è¯•ï¼Œä¹‹å‰ä¹Ÿæ²¡æœ‰ç»éªŒï¼Œä½†æ˜¯éå¸¸æ•é”åœ°èœ˜è››æ„Ÿåº”åˆ°äº†è¿™ä¸€ç‚¹ï¼Œä¸€æŸ¥èµ„æ–™ï¼Œæœç„¶æœ‰å‘ï¼Œè¿™å°±æ˜¯å¤©èµ‹å§ã€‚

è°ƒè¯•å¤šæ–‡ä»¶ä¸Šä¼ ï¼š
[# SpringBooté¡¹ç›®ä¸­ä½¿ç”¨MultipartFileæ¥ä¸Šä¼ æ–‡ä»¶(åŒ…å«å¤šæ–‡ä»¶)](https://blog.csdn.net/Aplumage/article/details/126347647)

[# è§£å†³knife4jå¤šæ–‡ä»¶ä¸Šä¼ é—®é¢˜](https://blog.csdn.net/liouwb/article/details/124491092)

> æœªè§£å†³ï¼šknife4jæ— æ³•è°ƒè¯•å¤šæ–‡ä»¶ä¸Šä¼ æ¥å£ã€‚å› ä¸ºæˆ‘ç”¨çš„æ˜¯OpenAPI3ï¼Œæ²¡æœ‰è¯¥æ³¨è§£ã€‚å¾—ç”¨postmanè°ƒè¯•ã€‚ä¸å¤ªæƒ³è£…postmanäº†ã€‚

### DAY 8

ä»Šå¤©å¯¹æ¥å£åšäº†ä¸€éæ£€æŸ¥ï¼Œä¿®ä¿®è¡¥è¡¥ä¹‹åï¼Œç»ˆäºå‘å¸ƒäº†ç¬¬ä¸€ä¸ªé¢„è§ˆç‰ˆ~
0.1.0 ç‰ˆæœ¬å‘å¸ƒï¼

### DAY 9

<https://blog.csdn.net/Lisonseekpan/article/details/156236090>

æ–°å¢é‚®ä»¶é€šçŸ¥åŠŸèƒ½ï¼Œå‘å¸ƒ 0.2.0ç‰ˆæœ¬ï¼

![é¡¹ç›®è¿è¡Œå›¾](/backend/editorial-system-backend.png)

ç›®å‰çš„é¡¹ç›®ä»£ç ç»Ÿè®¡ï¼š

| language | files |  code | comment | blank | total |
| :------- | ----: | ----: | ------: | ----: | ----: |
| Java     |    95 | 3,170 |     585 |   828 | 4,583 |
| XML      |     1 |   151 |       6 |    11 |   168 |
| HTML     |     8 |    86 |       0 |     7 |    93 |
| Markdown |     1 |    62 |       0 |    24 |    86 |
| YAML     |     1 |    58 |       5 |     4 |    67 |
